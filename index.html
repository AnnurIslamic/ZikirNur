<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZikirNur</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <style>
body {
    -webkit-user-select: none; /* Safari */
    -ms-user-select: none; /* IE 10 dan IE 11 */
    user-select: none; /* Standard syntax */
}
        
        /* --- Global Reset & Box Sizing --- */
        *,
        *::before,
        *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        /* === [BARU] CSS UNTUK KARTU MOTIVASI === */
        .motivation-card {
            background: linear-gradient(135deg, var(--dark-green) 0%, var(--primary-color) 100%);
            color: white;
            border-radius: 20px;
            padding: 1.8rem 1.5rem;
            margin-top: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
            position: relative;
            overflow: hidden;
        }
        .motivation-card h4 {
            font-family: 'Poppins', sans-serif;
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .motivation-card #motivasi-realtime {
            font-size: 1.1rem;
            font-style: italic;
            line-height: 1.6;
            margin-bottom: 1rem;
        }
        .motivation-card #motivasi-timestamp {
            font-size: 0.8rem;
            opacity: 0.7;
            text-align: right;
            display: block;
        }
        /* === AKHIR DARI CSS BARU === */

        :root {
            --primary-color: #00796B; /* Teal */
            --secondary-color: #4CAF50; /* Green */
            --accent-color: #FFC107; /* Amber for highlight */
            --bg-color-light: #FDF5EC; /* Light Beige from screenshots */
            --text-color-light: #2C3E50; /* Darker text */
            --card-bg-light: #FFFFFF;
            --dark-green: #004D40;
            --border-color-light: #E0E0E0;
            --icon-color-light: #7F8C8D; /* Greyish icon */
            --bg-color: var(--bg-color-light);
            --text-color: var(--text-color-light);
            --card-bg: var(--card-bg-light);
            --border-color: var(--border-color-light);
            --icon-color: var(--icon-color-light);
        }

        .dark-mode {
            --primary-color: #66BB6A;
            --secondary-color: #81C784;
            --accent-color: #FFD54F;
            --bg-color: #1A202C;
            --text-color: #E0E0E0;
            --card-bg: #2D3748;
            --border-color: #4A5568;
            --icon-color: #A0AEC0;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.3s ease, color 0.3s ease;
            line-height: 1.6;
        }

        main {
            width: 100%;
            max-width: 800px;
            padding: 1.5rem;
            margin: 0 auto;
        }

        .content-section {
            display: none;
            padding-top: 1rem;
        }
        .content-section.active { display: block; }

        h2 {
            font-family: 'Playfair Display', serif;
            font-size: 2.2rem;
            text-align: center;
            color: var(--primary-color);
            margin-bottom: 2.5rem;
            position: relative;
        }
        h2::after {
            content: '';
            position: absolute;
            left: 50%;
            bottom: -10px;
            transform: translateX(-50%);
            width: 60px;
            height: 3px;
            background-color: var(--accent-color);
            border-radius: 2px;
        }
        .dark-mode h2 { color: var(--primary-color); }
        .explanation-container h4 {
            font-family: 'Poppins', sans-serif;
            font-size: 1.2rem;
            margin-top: 1.5rem;
            margin-bottom: 0.5rem;
            color: var(--text-color);
        }
        .explanation-container ul {
            list-style-position: inside;
            padding-left: 0.5rem;
        }
        .explanation-container ul li {
            margin-bottom: 0.5rem;
        }
        
        .top-bar {
            background-color: var(--primary-color);
            color: white;
            padding: 1rem 1.5rem;
            display: flex;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .icon-btn {
            background: none;
            border: none;
            color: inherit;
            cursor: pointer;
            padding: 0;
            font-size: 1.8rem;
            transition: transform 0.2s ease;
        }
        .icon-btn:hover { transform: scale(1.1); }

        .menu-icon-btn {
            margin-right: 1rem;
        }
        
        .top-bar-title {
            font-family: 'Playfair Display', serif;
            font-size: 1.8rem;
            font-weight: 700;
        }

        .overlay {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            z-index: 999;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.4s ease, visibility 0.4s ease;
            backdrop-filter: blur(2px);
        }
        .overlay.active { opacity: 1; visibility: visible; }

        .sidebar {
            height: 100%;
            width: 280px;
            position: fixed;
            z-index: 1001;
            top: 0; left: 0;
            background-color: var(--card-bg);
            overflow-x: hidden;
            transition: transform 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            box-shadow: 4px 0 15px rgba(0,0,0,0.2);
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            transform: translateX(-100%);
        }
        .sidebar.active { transform: translateX(0); }

        .sidebar .header-title {
            font-family: 'Playfair Display', serif;
            font-size: 1.9rem;
            font-weight: 700;
            color: var(--primary-color);
            padding: 1.5rem;
            margin-bottom: 1rem;
            border-bottom: 1px solid var(--border-color);
        }

        .sidebar-nav-list { list-style: none; }
        .sidebar-nav-list a {
            padding: 1rem 1.5rem;
            text-decoration: none;
            font-size: 1.1rem;
            color: var(--text-color);
            display: flex;
            align-items: center;
            gap: 1rem;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        .sidebar-nav-list a i {
            width: 24px;
            text-align: center;
            color: var(--icon-color);
        }
        .sidebar-nav-list a:hover,
        .sidebar-nav-list a.current-page {
            background-color: var(--bg-color-light);
            color: var(--primary-color);
            font-weight: 600;
        }
        .dark-mode .sidebar-nav-list a:hover,
        .dark-mode .sidebar-nav-list a.current-page {
             background-color: #3B4455;
             color: var(--primary-color);
        }
        .sidebar-nav-list a:hover i,
        .sidebar-nav-list a.current-page i { color: var(--primary-color); }

        #dashboard-section { padding-top: 0; }
        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        .dashboard-header h3 {
            font-family: 'Poppins', sans-serif;
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--text-color);
        }
        .dashboard-header p {
            font-size: 0.9rem;
            color: var(--icon-color);
        }
        .dashboard-header .info-icon-btn,
        .dashboard-header .moon-icon-btn {
            font-size: 1.3rem;
            color: var(--icon-color);
        }
        .dashboard-header .info-icon-btn:hover { color: var(--accent-color); }
        .dashboard-header .moon-icon-btn.dark-mode-active { color: var(--primary-color); }
        .dashboard-header .icon-group {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .prayer-time-card {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--dark-green) 100%);
            color: white;
            border-radius: 20px;
            padding: 1.8rem 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
            position: relative;
            overflow: hidden;
            transition: opacity 0.5s ease;
        }
        .prayer-time-card.loading {
            opacity: 0.7;
        }
        .prayer-time-card::before {
            content: '';
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: url('data:image/svg+xml;utf8,<svg width="100" height="100" viewBox="0 0 100" xmlns="http://www.w3.org/2000/svg"><path d="M 50 0 L 100 50 L 50 100 L 0 50 Z" fill="%23FFFFFF" opacity="0.05"/></svg>') repeat;
            background-size: 80px;
            opacity: 0.1;
            z-index: 0;
        }
        .prayer-time-card > * { position: relative; z-index: 1; }
        .card-location {
            font-size: 1rem;
            font-weight: 500;
            margin-bottom: 0.5rem;
            opacity: 0.9;
        }
        .card-date {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-bottom: 1.5rem;
        }
        .prayer-times-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 1rem;
            text-align: center;
        }
        .prayer-time-item {
            background-color: rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            padding: 0.8rem 0.5rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 0.3rem;
            transition: background-color 0.2s ease, transform 0.2s ease;
        }
        .prayer-time-item.next-prayer {
            background-color: var(--accent-color);
            color: #333;
            font-weight: 700;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            transform: translateY(-3px);
        }
        .prayer-time-item.next-prayer span,
        .prayer-time-item.next-prayer strong { color: #333; }
        .prayer-time-item span { font-size: 0.85rem; font-weight: 500; }
        .prayer-time-item strong {
            font-family: 'Poppins', sans-serif;
            font-size: 1.2rem;
            font-weight: 700;
            letter-spacing: -0.5px;
        }

        .featured-zikir-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 2rem;
        }
        .zikir-card {
            background-color: var(--card-bg);
            padding: 1.8rem 1rem;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
        }
        .zikir-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }
        .zikir-card > i {
            font-size: 3rem;
            margin-bottom: 1rem;
            transition: color 0.2s ease;
        }
        .zikir-card.pagi > i { color: #FDD835; }
        .zikir-card.petang > i { color: #7986CB; }
        .zikir-card h4 {
            font-family: 'Poppins', sans-serif;
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--text-color);
        }
        .zikir-card p.subtitle {
            font-size: 0.85rem;
            color: var(--icon-color);
            margin-top: 0.5rem;
            margin-bottom: 1.5rem;
        }
        
        .audio-controls-container {
            display: flex;
            gap: 1rem;
            justify-content: center;
            align-items: center;
        }

        .audio-btn {
            width: 45px;
            height: 45px;
            background-color: var(--primary-color);
            border: none;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 1.1rem;
            cursor: pointer;
            transition: background-color 0.2s ease, transform 0.2s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.15);
        }
        .audio-btn:hover {
            background-color: var(--secondary-color);
            transform: scale(1.1);
        }
        .audio-btn.stop-btn {
            background-color: #E53935;
        }
        .audio-btn.stop-btn:hover {
            background-color: #C62828;
        }
        .hidden {
            display: none;
        }

        .shortcut-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 1.2rem;
            margin-top: 2rem;
        }
        .shortcut-item {
            background-color: var(--card-bg);
            border-radius: 15px;
            padding: 1.2rem 0.5rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 0.8rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            cursor: pointer;
            text-decoration: none;
            color: var(--text-color);
            text-align: center;
        }
        .shortcut-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        .shortcut-icon {
            font-size: 2rem;
            color: var(--primary-color);
            transition: color 0.2s ease;
        }
        .shortcut-item:hover .shortcut-icon { color: var(--secondary-color); }
        .shortcut-item span {
            font-size: 0.8rem;
            color: var(--text-color);
            font-weight: 500;
            line-height: 1.3;
        }
        
        .icon-btn:focus-visible, .audio-btn:focus-visible, .shortcut-item:focus-visible, .survey-button:focus-visible, .settings-item a:focus-visible, .store-button:focus-visible, .switch input:focus-visible + .slider {
            outline: 3px solid var(--accent-color);
            outline-offset: 3px;
            box-shadow: 0 0 10px rgba(255, 193, 7, 0.5);
        }

        .survey-button {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.8rem;
            background-color: var(--accent-color);
            color: #333;
            text-align: center;
            padding: 1.2rem 1rem;
            border-radius: 15px;
            font-weight: 700;
            text-decoration: none;
            box-shadow: 0 6px 15px rgba(255, 193, 7, 0.4);
            transition: background-color 0.2s ease, transform 0.2s ease, box-shadow 0.2s ease;
            font-size: 1.1rem;
        }
        .survey-button:hover {
            background-color: #FFB300;
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(255, 193, 7, 0.5);
        }
        .survey-button i { font-size: 1.3rem; }

        /** [MODIFIKASI] CSS BARU UNTUK SLIDER TOMBOL SURVEY **/
        .survey-button-container {
            margin-top: 2.5rem;
            height: 65px; /* Sesuaikan tinggi agar pas dengan 1 tombol */
            border-radius: 15px;
            overflow: hidden;
            position: relative;
        }
        .survey-slider {
            transition: transform 0.8s cubic-bezier(0.68, -0.55, 0.27, 1.55); /* Animasi geser */
        }
        .survey-slider .survey-button {
            margin-top: 0; /* Hapus margin atas dari tombol individu */
            height: 65px; /* Pastikan tinggi setiap slide sama */
            flex-shrink: 0; /* Mencegah slide menyusut */
        }
        /** AKHIR DARI CSS BARU **/

        .settings-container, .explanation-container { padding: 0 0.5rem; }
        .settings-list {
            list-style: none;
            margin: 0 0 2rem 0;
            background-color: var(--card-bg);
            border-radius: 15px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            overflow: hidden;
        }
        .settings-list-title {
            font-family: 'Poppins', sans-serif;
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--primary-color);
            padding: 1.5rem 1.5rem 0.8rem;
        }
        .settings-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.2rem 1.5rem;
            border-bottom: 1px solid var(--border-color);
        }
        .settings-item:last-child { border-bottom: none; }
        .settings-item .setting-label { font-size: 1.1rem; font-weight: 500; }
        .settings-item .setting-value { font-size: 1rem; color: var(--icon-color); }
        .dark-mode .settings-item .setting-value { color: #bbb; }
        .settings-item a {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            text-decoration: none;
            color: inherit;
        }
        .settings-item .chevron-icon { color: var(--icon-color); margin-left: 1rem; font-size: 1rem; }
        .mode-toggle-container { display: flex; align-items: center; gap: 1rem; }
        .mode-toggle-container span { font-size: 1rem; font-weight: 500; }
        .mode-toggle-container .switch { position: relative; display: inline-block; width: 48px; height: 28px; }
        .mode-toggle-container .switch input { opacity: 0; width: 0; height: 0; }
        .mode-toggle-container .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 28px; }
        .dark-mode .mode-toggle-container .slider { background-color: #555; }
        .mode-toggle-container .slider:before { position: absolute; content: ""; height: 20px; width: 20px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
        .mode-toggle-container input:checked + .slider { background-color: var(--primary-color); }
        .mode-toggle-container input:checked + .slider:before { transform: translateX(20px); }
        .store-button { display: block; margin-top: 2rem; padding: 1rem; background-color: black; color: white; text-align: center; border-radius: 12px; text-decoration: none; font-weight: 600; transition: background-color 0.2s ease; }
        .store-button:hover { background-color: #222; }
        .store-button i { margin-right: 0.5rem; }

        footer { text-align: center; padding: 1.5rem; background-color: var(--primary-color); color: white; margin-top: 3.5rem; box-shadow: 0 -2px 10px rgba(0,0,0,0.1); }
        
        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
            z-index: 2000;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 1rem;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .popup-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        .popup-content {
            background-color: var(--card-bg);
            color: var(--text-color);
            padding: 2rem;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            max-width: 400px;
            width: 100%;
            text-align: center;
            transform: scale(0.9);
            opacity: 0;
            transition: transform 0.3s cubic-bezier(0.18, 0.89, 0.32, 1.28), opacity 0.3s ease;
        }
        .popup-overlay.active .popup-content {
            transform: scale(1);
            opacity: 1;
        }
        .popup-icon {
            font-size: 3.5rem;
            color: var(--primary-color);
            margin-bottom: 1rem;
        }
        .popup-title {
            font-family: 'Playfair Display', serif;
            font-size: 1.8rem;
            margin-bottom: 0.8rem;
            color: var(--text-color);
        }
        .popup-message {
            font-size: 1rem;
            line-height: 1.6;
            margin-bottom: 2rem;
            color: var(--icon-color);
        }
        .popup-actions {
            display: flex;
            gap: 1rem;
            justify-content: center;
        }
        .popup-btn {
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 12px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s ease;
            flex-grow: 1;
        }
        .popup-btn.primary {
            background-color: var(--primary-color);
            color: white;
        }
        .popup-btn.primary:hover {
            background-color: var(--secondary-color);
            transform: translateY(-2px);
        }
        .popup-btn.secondary {
            background-color: transparent;
            color: var(--text-color);
            border: 2px solid var(--border-color);
        }
        .dark-mode .popup-btn.secondary {
             color: var(--text-color);
        }
        .popup-btn.secondary:hover {
            background-color: var(--border-color);
        }
        
        .refreshing {
            animation: spin 1.2s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .top-bar-title, .sidebar .header-title { font-size: 1.6rem; }
            h2 { font-size: 1.8rem; }
            .prayer-times-grid { grid-template-columns: repeat(3, 1fr); gap: 0.8rem; }
            .featured-zikir-container { grid-template-columns: 1fr; }
        }
        @media (max-width: 480px) {
            main { padding: 1rem; }
            .sidebar { width: 250px; }
            .top-bar-title, .sidebar .header-title { font-size: 1.4rem; }
            h2 { font-size: 1.6rem; }
            .prayer-time-card { padding: 1.5rem 1rem; }
            .prayer-times-grid { grid-template-columns: repeat(2, 1fr); }
            .prayer-time-item strong { font-size: 1.1rem; }
            .zikir-card { padding: 1.5rem 1rem; }
            .zikir-card > i { font-size: 2.5rem; }
            .zikir-card h4 { font-size: 1.2rem; }
            .shortcut-grid { grid-template-columns: repeat(auto-fit, minmax(90px, 1fr)); }
            .survey-button { font-size: 1rem; }
            .settings-item { flex-direction: column; align-items: flex-start; gap: 0.8rem; padding: 1rem 1.2rem; }
            .mode-toggle-container { width: 100%; justify-content: space-between; }
        }

        /* === [BARU] CSS UNTUK FITUR AL-QUR'AN === */
        #quran-container {
            padding: 0 0.5rem;
        }
        .surah-item {
            background-color: var(--card-bg);
            border-radius: 15px;
            border: 1px solid var(--border-color);
            padding: 1rem 1.2rem;
            margin-bottom: 0.8rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .surah-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(0,0,0,0.1);
        }
        .surah-item-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        .surah-number {
            background-color: var(--primary-color);
            color: white;
            font-weight: 600;
            width: 35px;
            height: 35px;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 50%;
            font-size: 0.9rem;
        }
        .surah-name h4 {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-color);
            margin: 0;
        }
        .surah-name p {
            font-size: 0.8rem;
            color: var(--icon-color);
            margin: 0;
        }
        .surah-arabic-name {
            font-size: 1.5rem;
            color: var(--primary-color);
            font-weight: 500;
        }
        .dark-mode .surah-arabic-name {
             color: var(--accent-color);
        }

        #surah-detail-header {
            background: linear-gradient(135deg, var(--dark-green) 0%, var(--primary-color) 100%);
            color: white;
            border-radius: 20px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            text-align: center;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }
        #surah-detail-header h3 {
            font-family: 'Playfair Display', serif;
            font-size: 2rem;
            margin: 0;
        }
        #surah-detail-header p {
            font-size: 1rem;
            opacity: 0.8;
            margin: 0.5rem 0 0 0;
        }

        .verse-item {
            background-color: var(--card-bg);
            border-radius: 15px;
            border: 1px solid var(--border-color);
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }
        .verse-number {
            background-color: var(--primary-color);
            color: white;
            font-weight: 600;
            width: 30px;
            height: 30px;
            display: inline-flex;
            justify-content: center;
            align-items: center;
            border-radius: 50%;
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }
        .verse-arabic {
            font-size: 1.8rem;
            color: var(--text-color);
            text-align: right;
            line-height: 2.2;
            margin-bottom: 1.5rem;
            /* Font Quran yang lebih baik jika tersedia */
            font-family: 'Times New Roman', serif; 
        }
        .dark-mode .verse-arabic {
             color: var(--text-color);
        }
        .verse-translation {
            font-size: 0.95rem;
            color: var(--icon-color);
            font-style: italic;
            line-height: 1.6;
            border-top: 1px dashed var(--border-color);
            padding-top: 1rem;
        }

        /* === [BARU] CSS UNTUK AUDIO PLAYER AL-QUR'AN === */
        .verse-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-top: 1.5rem;
            padding-top: 1rem;
            border-top: 1px dashed var(--border-color);
        }

        .audio-control-btn {
            background-color: var(--card-bg);
            border: 2px solid var(--border-color);
            color: var(--icon-color);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }
        .audio-control-btn:hover {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            color: white;
        }

        .audio-control-btn .fa-spin {
            animation-duration: 1.5s;
        }
        
        .audio-control-btn.playing .icon-play,
        .audio-control-btn:not(.playing) .icon-pause,
        .audio-control-btn:not(.loading) .icon-loading {
            display: none;
        }
        
        .audio-control-btn.loading .icon-loading {
            display: inline-block;
        }
        .audio-control-btn.loading .icon-play {
            display: none;
        }
        
        .audio-control-btn.playing .icon-pause {
            display: inline-block;
        }
        /* === AKHIR CSS AUDIO === */

        /* === CSS untuk Dzikir Ba'da Sholat === */
        .dhikr-container-new { position: relative; width: 100%; max-width: 450px; margin: 0 auto; overflow: hidden; }
        .dhikr-slider-new { display: flex; transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1); }
        .dhikr-slide-new { min-width: 100%; box-sizing: border-box; padding: 0 10px; }
        .dhikr-progress { padding: 0 5px; margin-bottom: 0.8rem; }
        .progress-text { font-size: 0.9rem; font-weight: 500; color: var(--icon-color); margin-bottom: 0.5rem; display: block; }
        .progress-bar-container { width: 100%; height: 6px; background-color: var(--border-color); border-radius: 6px; overflow: hidden; }
        .progress-bar-fill { width: 0%; height: 100%; background-color: var(--primary-color); border-radius: 6px; transition: width 0.4s ease; }
        .dhikr-card-new { background: linear-gradient(145deg, var(--card-bg) 0%, var(--bg-color) 100%); border-radius: 24px; padding: 2rem 1.5rem; text-align: center; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1); border: 1px solid var(--border-color); display: flex; flex-direction: column; align-items: center; }
        .dark-mode .dhikr-card-new { background: linear-gradient(145deg, var(--card-bg) 0%, #171e2a 100%); }
        .dhikr-title-new { font-family: 'Poppins', sans-serif; font-size: 1.3rem; font-weight: 600; color: var(--text-color); margin-bottom: 1.5rem; }
        .dhikr-arabic-new { font-size: 3rem; font-weight: 500; color: var(--primary-color); margin-bottom: 1rem; line-height: 1.5; }
        .dark-mode .dhikr-arabic-new { color: var(--accent-color); }
        .dhikr-translation-new { font-size: 1rem; color: var(--icon-color); margin-bottom: 2rem; font-style: italic; }
        .counter-wrapper { display: flex; flex-direction: column; align-items: center; gap: 1rem; margin-bottom: 1rem; }
        .progress-counter { position: relative; width: 120px; height: 120px; border-radius: 50%; background-color: var(--card-bg); border: none; cursor: pointer; display: flex; justify-content: center; align-items: center; box-shadow: 0 5px 15px rgba(0,0,0,0.1); transition: transform 0.2s ease; }
        .progress-counter:active { transform: scale(0.95); }
        .progress-ring { position: absolute; top: 0; left: 0; transform: rotate(-90deg); }
        .progress-ring__bg { stroke: var(--border-color); }
        .progress-ring__circle { stroke: var(--primary-color); stroke-linecap: round; transition: stroke-dashoffset 0.3s linear; }
        .count-display-new { font-size: 2.5rem; font-weight: 700; color: var(--text-color); }
        .reset-btn-new { background: none; border: none; color: var(--icon-color); cursor: pointer; font-size: 0.9rem; opacity: 0.7; transition: opacity 0.2s ease; }
        .reset-btn-new:hover { opacity: 1; }
        .target-count-new { font-size: 0.9rem; font-weight: 500; color: var(--text-color); background-color: var(--bg-color); padding: 0.3rem 1rem; border-radius: 15px; }
        .slider-nav-new { position: absolute; top: 50%; transform: translateY(-50%); background-color: var(--card-bg); border: 1px solid var(--border-color); border-radius: 50%; width: 44px; height: 44px; cursor: pointer; color: var(--icon-color); font-size: 1.1rem; z-index: 10; box-shadow: 0 4px 12px rgba(0,0,0,0.1); display: flex; justify-content: center; align-items: center; transition: all 0.2s ease; }
        .slider-nav-new:hover { background-color: var(--primary-color); color: white; }
        .slider-nav-new.prev { left: -15px; }
        .slider-nav-new.next { right: -15px; }
        
        /* === CSS untuk TATA CARA SHOLAT & DOA NABI === */
        .prayer-guide-container { display: flex; flex-direction: column; gap: 1rem; }
        .prayer-step { background-color: var(--card-bg); border-radius: 15px; border: 1px solid var(--border-color); box-shadow: 0 4px 12px rgba(0,0,0,0.05); overflow: hidden; }
        .step-header { width: 100%; display: flex; justify-content: space-between; align-items: center; padding: 1.2rem 1.5rem; background-color: transparent; border: none; cursor: pointer; text-align: left; font-family: 'Poppins', sans-serif; font-size: 1.1rem; font-weight: 600; color: var(--text-color); }
        .step-header:hover { background-color: var(--bg-color); }
        .step-icon { font-size: 1.2rem; color: var(--primary-color); transition: transform 0.3s ease; }
        .step-header.active .step-icon { transform: rotate(45deg); }
        .step-content { max-height: 0; overflow: hidden; transition: max-height 0.4s ease-out; padding: 0 1.5rem; }
        .step-content .content-wrapper { padding: 1.5rem 0; border-top: 1px solid var(--border-color); display: flex; flex-direction: column; gap: 1.2rem; }
        .step-content p { margin: 0; }
        .arabic-text { font-size: 1.8rem; color: var(--primary-color); text-align: right; line-height: 1.8; }
        .dark-mode .arabic-text { color: var(--accent-color); }
        .transliteration-text { font-size: 1rem; color: var(--text-color); font-style: italic; font-weight: 500; }
        .translation-text { font-size: 0.9rem; color: var(--icon-color); }
        .step-note { font-size: 0.9rem; padding: 0.8rem 1rem; background-color: var(--bg-color); border-radius: 10px; border-left: 4px solid var(--accent-color); }
        
        /* === CSS untuk ARAH KIBLAT === */
        .kiblat-container { display: flex; flex-direction: column; align-items: center; gap: 2rem; padding: 1rem 0; }
        #kiblat-permission-prompt { text-align: center; background-color: var(--card-bg); padding: 1.5rem; border-radius: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        #kiblat-permission-prompt p { margin-bottom: 1rem; }
        #kiblat-permission-btn { border: none; background-color: var(--primary-color); color: white; padding: 0.8rem 1.5rem; border-radius: 10px; font-weight: 600; cursor: pointer; }
        .compass-ui-container { display: flex; flex-direction: column; align-items: center; width: 100%; }
        .compass { position: relative; width: 280px; height: 280px; }
        .compass-circle { width: 100%; height: 100%; background-color: var(--card-bg); border: 5px solid var(--primary-color); border-radius: 50%; box-shadow: 0 5px 20px rgba(0,0,0,0.1); position: relative; transition: border-color 0.4s ease, box-shadow 0.4s ease; }
        .compass-circle.aligned { border-color: var(--secondary-color); box-shadow: 0 0 25px var(--secondary-color); }
        .compass-rose { width: 100%; height: 100%; position: absolute; top: 0; left: 0; transition: transform 0.2s linear; }
        .degree-mark { position: absolute; font-size: 1.3rem; font-weight: bold; color: var(--text-color); }
        .degree-mark.north { top: 10px; left: 50%; transform: translateX(-50%); }
        .degree-mark.east { top: 50%; right: 10px; transform: translateY(-50%); }
        .degree-mark.south { bottom: 10px; left: 50%; transform: translateX(-50%); }
        .degree-mark.west { top: 50%; left: 10px; transform: translateY(-50%); }
        .qibla-pointer { position: absolute; top: -35px; left: 50%; transform-origin: center 175px; /* 140px (radius) + 35px (offset) */ z-index: 4; transition: transform 0.2s linear; }
        .kaaba-icon { font-size: 2.5rem; color: var(--accent-color); text-shadow: 0 0 10px rgba(0,0,0,0.3); }
        .lubber-line { position: absolute; top: 0; left: 50%; transform: translateX(-50%); width: 4px; height: 30px; background-color: #e74c3c; border-radius: 2px; z-index: 3; }
        .kiblat-info-box { text-align: center; background-color: var(--card-bg); padding: 1.2rem; border-radius: 15px; width: 100%; max-width: 320px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        .kiblat-info-box .direction-degree { font-size: 1.1rem; font-weight: 600; color: var(--primary-color); min-height: 2em; }
        .kiblat-info-box .calibration-info { font-size: 0.8rem; color: var(--icon-color); line-height: 1.4; margin-top: 0.5rem; }

        /* === CSS untuk TASBIH DIGITAL === */
        #tasbih-digital-section {
            --tasbih-input-bg: #EFEBE9;
            --tasbih-btn-bg: #C3A381;
            --tasbih-text-color: #5D4037;
            --tasbih-counter-bg: #FFFFFF;
            --tasbih-counter-border: #E0E0E0;
        }

        .dark-mode #tasbih-digital-section {
            --tasbih-input-bg: #3B4455;
            --tasbih-btn-bg: #8E6E53;
            --tasbih-text-color: var(--text-color);
            --tasbih-counter-bg: #2D3748;
            --tasbih-counter-border: #4A5568;
        }

        .tasbih-container {
            max-width: 400px;
            margin: 1rem auto;
            padding: 1rem;
            background-color: transparent;
            border-radius: 15px;
            font-family: 'Poppins', sans-serif;
        }

        .tasbih-setup-container {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .tasbih-form-group {
            width: 100%;
        }

        #dzikir-select,
        #custom-dzikir-input,
        #dzikir-target {
            width: 100%;
            padding: 1rem;
            border: 1px solid var(--tasbih-input-bg);
            background-color: var(--tasbih-input-bg);
            border-radius: 12px;
            font-size: 1rem;
            color: var(--tasbih-text-color);
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
        }
        #dzikir-select {
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%235D4037' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 1rem center;
            background-size: 1em;
            cursor: pointer;
        }

        #dzikir-target::placeholder,
        #custom-dzikir-input::placeholder {
            color: #9E9E9E;
        }

        .tasbih-btn {
            width: 100%;
            padding: 1rem;
            background-color: var(--tasbih-btn-bg);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        .tasbih-btn:hover {
            background-color: #b1906f; 
        }
        .dark-mode .tasbih-btn:hover {
            background-color: #7d5e42;
        }

        .tasbih-counter-container {
            text-align: center;
            padding-top: 2rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1.5rem;
        }

        #display-dzikir-text {
            font-size: 2rem;
            font-weight: 700;
            color: var(--tasbih-text-color);
            margin: 0;
        }

        #display-dzikir-target {
            font-size: 1.2rem;
            font-weight: 500;
            color: var(--icon-color);
            margin-top: -1rem;
        }

        .counter-ui {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background-color: var(--tasbih-counter-bg);
            border: 1px solid var(--tasbih-counter-border);
            border-radius: 50px;
            padding: 0.5rem;
            width: 100%;
            max-width: 280px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        }

        #tasbih-count-display {
            font-size: 3.5rem;
            font-weight: 700;
            color: var(--tasbih-text-color);
            flex-grow: 1;
        }

        .tasbih-control-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--tasbih-text-color);
            cursor: pointer;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.1s ease;
        }
        .tasbih-control-btn:active {
            transform: scale(0.9);
        }

        #reset-setup-link {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 500;
            margin-top: 1rem;
            border-bottom: 2px solid transparent;
            transition: border-color 0.2s;
        }
        #reset-setup-link:hover {
            border-bottom-color: var(--primary-color);
        }


        @media (max-width: 480px) {
            .slider-nav-new.prev { left: -5px; }
            .slider-nav-new.next { right: -5px; }
            .dhikr-card-new { padding: 1.5rem; }
            .dhikr-arabic-new { font-size: 2.5rem; }
            .step-header { padding: 1rem 1.2rem; font-size: 1rem; }
            .step-content { padding: 0 1.2rem; }
            .arabic-text { font-size: 1.6rem; }
            .compass { width: 240px; height: 240px; }
            .qibla-pointer { transform-origin: center 155px; /* 120px radius + 35px offset */ }
        }

        

        /* === [BARU] CSS UNTUK TOMBOL AUTOPLAY QURAN === */
        #quran-autoplay-toggle {
            border-color: rgba(255,255,255,0.5);
            color: rgba(255,255,255,0.8);
            background-color: transparent;
        }
        #quran-autoplay-toggle:hover {
            background-color: rgba(255,255,255,0.1);
            color: white;
            border-color: rgba(255,255,255,0.7);
        }
        #quran-autoplay-toggle.active {
            background-color: var(--accent-color);
            color: #333;
            border-color: var(--accent-color);
            font-weight: 600;
        }
        #quran-autoplay-toggle.active:hover {
             background-color: #FFD54F; /* Warna hover saat aktif */
             color: #333;
        }
        /* === AKHIR CSS AUTOPLAY === */

        /* === [BARU] CSS UNTUK TOMBOL TOGGLE QURAN === */
        #quran-display-toggles {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
            margin-top: 1.5rem;
        }
        .toggle-btn {
            background-color: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.4);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.8rem;
            font-weight: 600;
            transition: all 0.2s ease;
        }
        .toggle-btn:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }
        .toggle-btn.active {
            background-color: var(--accent-color);
            border-color: var(--accent-color);
            color: #333;
        }
        /* === AKHIR CSS TOGGLE === */
    </style>
</head>
<body>
    <div class="top-bar">
        <button class="icon-btn menu-icon-btn" id="openSidebarBtn" aria-label="Buka Menu">
            <i class="fas fa-bars" aria-hidden="true"></i>
        </button>
        <div class="top-bar-title">ZikirNur</div>
    </div>
    <div id="mySidebar" class="sidebar">
        <div class="header-title">Menu Navigasi</div>
<ul class="sidebar-nav-list">
            <li><a href="#dashboard" class="nav-link"><i class="fas fa-home" aria-hidden="true"></i> Beranda</a></li>
            <li><a href="#penjelasan" class="nav-link"><i class="fas fa-book-open" aria-hidden="true"></i> Penjelasan Zikir</a></li>
            <li><a href="#pengaturan" class="nav-link"><i class="fas fa-cog" aria-hidden="true"></i> Pengaturan</a></li>
            <li><a href="#quran" class="nav-link"><i class="fas fa-book-quran" aria-hidden="true"></i> Al-Qur'an</a></li>
        </ul>
    </div>
    <div class="overlay" id="sidebarOverlay"></div>
    <main>
        <section id="dashboard-section" class="content-section active">
            <div class="dashboard-header">
                <div>
                    <h3>Dzikir Pagi Petang</h3>
                    <p>Sesuai Sunnah</p>
                </div>
                <div class="icon-group">
                    <button id="infoToSettingsBtn" class="icon-btn info-icon-btn" aria-label="Informasi Aplikasi">
                        <i class="fas fa-info-circle" aria-hidden="true"></i>
                    </button>
                    <button class="icon-btn moon-icon-btn" id="darkModeIcon" aria-label="Ganti Mode Tampilan">
                        <i class="fas fa-moon" aria-hidden="true"></i>
                    </button>
                </div>
            </div>
            <div class="prayer-time-card">
                <p class="card-location">Medan, Sumatera Utara</p>
                <p class="card-date" id="currentDateHijri" lang="ar"></p>
                <div class="prayer-times-grid" id="prayerTimesGrid">
                    <div class="prayer-time-item"><span>Imsak</span><strong id="time-Imsak">--:--</strong></div>
                    <div class="prayer-time-item"><span>Subuh</span><strong id="time-Fajr">--:--</strong></div>
                    <div class="prayer-time-item"><span>Dzuhur</span><strong id="time-Dhuhr">--:--</strong></div>
                    <div class="prayer-time-item"><span>Ashar</span><strong id="time-Asr">--:--</strong></div>
                    <div class="prayer-time-item"><span>Maghrib</span><strong id="time-Maghrib">--:--</strong></div>
                    <div class="prayer-time-item"><span>Isya</span><strong id="time-Isha">--:--</strong></div>
                </div>
            </div>

            <div class="featured-zikir-container">
                <div class="zikir-card pagi">

                    <i class="fas fa-sun" aria-hidden="true"></i>
                    <h4>Dzikir Pagi</h4>
                    <p class="subtitle">Ba'da Subuh</p>
                    
                    <div class="audio-controls-container">
                        <button class="audio-btn play-btn" data-target="audio-pagi" aria-label="Putar audio zikir pagi"><i class="fas fa-play" aria-hidden="true"></i></button>
                        <button class="audio-btn pause-btn hidden" data-target="audio-pagi" aria-label="Jeda audio zikir pagi"><i class="fas fa-pause" aria-hidden="true"></i></button>
                        <button class="audio-btn stop-btn hidden" data-target="audio-pagi" aria-label="Hentikan audio zikir pagi"><i class="fas fa-stop" aria-hidden="true"></i></button>
                    </div>
                </div>
                <div class="zikir-card petang">

                    <i class="fas fa-moon" aria-hidden="true"></i>
                    <h4>Dzikir Petang</h4>
                    <p class="subtitle">Ba'da Ashar</p>
                        
                    <div class="audio-controls-container">
                        <button class="audio-btn play-btn" data-target="audio-petang" aria-label="Putar audio zikir petang"><i class="fas fa-play" aria-hidden="true"></i></button>
                        <button class="audio-btn pause-btn hidden" data-target="audio-petang" aria-label="Jeda audio zikir petang"><i class="fas fa-pause" aria-hidden="true"></i></button>
                        <button class="audio-btn stop-btn hidden" data-target="audio-petang" aria-label="Hentikan audio zikir petang"><i class="fas fa-stop" aria-hidden="true"></i></button>
                    </div>
                </div>
            </div>
            
            <div class="shortcut-grid">
                <a href="#dzikir-bada-sholat" class="shortcut-item nav-shortcut"><i class="fas fa-hand-holding-heart shortcut-icon" aria-hidden="true"></i><span>Dzikir Ba'da Sholat</span></a>
                <a href="#tata-cara-sholat" class="shortcut-item nav-shortcut"><i class="fas fa-mosque shortcut-icon" aria-hidden="true"></i><span>Tata Cara Sholat</span></a>
                <a href="#doa-nabi" class="shortcut-item nav-shortcut"><i class="fas fa-book-reader shortcut-icon" aria-hidden="true"></i><span>Doa Para Nabi</span></a>
                <a href="#kiblat" class="shortcut-item nav-shortcut"><i class="fas fa-compass shortcut-icon" aria-hidden="true"></i><span>Arah Kiblat</span></a>
                <a href="#doa-harian" class="shortcut-item nav-shortcut"><i class="fas fa-hands-praying shortcut-icon" aria-hidden="true"></i><span>Doa Harian</span></a>
                <a href="#tasbih-digital" class="shortcut-item nav-shortcut"><i class="fas fa-calculator shortcut-icon" aria-hidden="true"></i><span>Penghitung Digital</span></a>
                <a href="#quran" class="shortcut-item nav-shortcut"><i class="fas fa-book-quran shortcut-icon" aria-hidden="true"></i><span>Al-Qur'an</span></a>
        </div>
            
            <div class="motivation-card">
                <h4><i class="fas fa-heartbeat"></i> Motivasi Hari Ini</h4>
                <p id="motivasi-realtime">Memuat motivasi...</p>
                <small id="motivasi-timestamp"></small>
            </div>

            <div class="survey-button-container">
                <div class="survey-slider">
                <a href="mailto:zikirn23@gmail.com" target="_blank" class="survey-button">
                        <i class="fas fa-comment-dots" aria-hidden="true"></i> Saran & Masukan
                    </a>
                    <a href="https://play.google.com/store/apps/details?id=your.app.id.here" target="_blank" class="survey-button" style="background-color: var(--primary-color); color: white;">
                        <i class="fas fa-star" aria-hidden="true"></i> Dukung Aplikasi
                    </a>
                    <a href="https://forms.gle/WgPQVnNVuqd9WbQQA" target="_blank" class="survey-button">
                        <i class="fas fa-clipboard-list" aria-hidden="true"></i> Isi Survey Yuk
                    </a>
                </div>
            </div>

        </section>
        
        <section id="dzikir-bada-sholat-section" class="content-section">
            <div class="dhikr-container-new">
                <div class="dhikr-slider-new">
                    <div class="dhikr-slide-new">
                        <div class="dhikr-progress"> <span class="progress-text">Dzikir 1 dari 7</span> <div class="progress-bar-container"> <div class="progress-bar-fill"></div> </div> </div>
                        <div class="dhikr-card-new">
                            <h3 class="dhikr-title-new">Membaca Istighfar</h3> <p class="dhikr-arabic-new"> </p> <p class="dhikr-translation-new">"Aku memohon ampun kepada Allah."</p>
                            <div class="counter-wrapper">
                                <button class="progress-counter" data-max="3" aria-label="Hitung Dzikir">
                                    <svg class="progress-ring" width="120" height="120"> <circle class="progress-ring__bg" stroke-width="6" fill="transparent" r="54" cx="60" cy="60"/> <circle class="progress-ring__circle" stroke-width="6" fill="transparent" r="54" cx="60" cy="60"/> </svg>
                                    <span class="count-display-new">0</span>
                                </button> <button class="reset-btn-new"><i class="fas fa-sync-alt"></i> Reset</button>
                            </div> <span class="target-count-new">Target: 3x</span>
                        </div>
                    </div>
                    <div class="dhikr-slide-new">
                        <div class="dhikr-progress"> <span class="progress-text">Dzikir 2 dari 7</span> <div class="progress-bar-container"> <div class="progress-bar-fill"></div> </div> </div>
                        <div class="dhikr-card-new">
                            <h3 class="dhikr-title-new">Bacaan Pujian</h3> <p class="dhikr-arabic-new" style="font-size: 1.7rem; line-height: 1.8;">         </p> <p class="dhikr-translation-new">"Ya Allah, Engkau-lah As-Salam, dan dari-Mu-lah keselamatan..."</p>
                            <div class="counter-wrapper">
                                <button class="progress-counter" data-max="1" aria-label="Hitung Dzikir">
                                    <svg class="progress-ring" width="120" height="120"> <circle class="progress-ring__bg" stroke-width="6" fill="transparent" r="54" cx="60" cy="60"/> <circle class="progress-ring__circle" stroke-width="6" fill="transparent" r="54" cx="60" cy="60"/> </svg>
                                    <span class="count-display-new">0</span>
                                </button> <button class="reset-btn-new"><i class="fas fa-sync-alt"></i> Reset</button>
                            </div> <span class="target-count-new">Target: 1x</span>
                        </div>
                    </div>
                    <div class="dhikr-slide-new">
                        <div class="dhikr-progress"> <span class="progress-text">Dzikir 3 dari 7</span> <div class="progress-bar-container"> <div class="progress-bar-fill"></div> </div> </div>
                        <div class="dhikr-card-new">
                            <h3 class="dhikr-title-new">Membaca Tasbih</h3> <p class="dhikr-arabic-new"> </p> <p class="dhikr-translation-new">"Maha Suci Allah."</p>
                            <div class="counter-wrapper">
                                <button class="progress-counter" data-max="33" aria-label="Hitung Dzikir">
                                    <svg class="progress-ring" width="120" height="120"> <circle class="progress-ring__bg" stroke-width="6" fill="transparent" r="54" cx="60" cy="60"/> <circle class="progress-ring__circle" stroke-width="6" fill="transparent" r="54" cx="60" cy="60"/> </svg>
                                    <span class="count-display-new">0</span>
                                </button> <button class="reset-btn-new"><i class="fas fa-sync-alt"></i> Reset</button>
                            </div> <span class="target-count-new">Target: 33x</span>
                        </div>
                    </div>
                    <div class="dhikr-slide-new">
                        <div class="dhikr-progress"> <span class="progress-text">Dzikir 4 dari 7</span> <div class="progress-bar-container"> <div class="progress-bar-fill"></div> </div> </div>
                        <div class="dhikr-card-new">
                            <h3 class="dhikr-title-new">Membaca Tahmid</h3> <p class="dhikr-arabic-new"> </p> <p class="dhikr-translation-new">"Segala puji bagi Allah."</p>
                            <div class="counter-wrapper">
                                <button class="progress-counter" data-max="33" aria-label="Hitung Dzikir">
                                    <svg class="progress-ring" width="120" height="120"> <circle class="progress-ring__bg" stroke-width="6" fill="transparent" r="54" cx="60" cy="60"/> <circle class="progress-ring__circle" stroke-width="6" fill="transparent" r="54" cx="60" cy="60"/> </svg>
                                    <span class="count-display-new">0</span>
                                </button> <button class="reset-btn-new"><i class="fas fa-sync-alt"></i> Reset</button>
                            </div> <span class="target-count-new">Target: 33x</span>
                        </div>
                    </div>
                    <div class="dhikr-slide-new">
                        <div class="dhikr-progress"> <span class="progress-text">Dzikir 5 dari 7</span> <div class="progress-bar-container"> <div class="progress-bar-fill"></div> </div> </div>
                        <div class="dhikr-card-new">
                            <h3 class="dhikr-title-new">Membaca Takbir</h3> <p class="dhikr-arabic-new"> </p> <p class="dhikr-translation-new">"Allah Maha Besar."</p>
                            <div class="counter-wrapper">
                                <button class="progress-counter" data-max="33" aria-label="Hitung Dzikir">
                                    <svg class="progress-ring" width="120" height="120"> <circle class="progress-ring__bg" stroke-width="6" fill="transparent" r="54" cx="60" cy="60"/> <circle class="progress-ring__circle" stroke-width="6" fill="transparent" r="54" cx="60" cy="60"/> </svg>
                                    <span class="count-display-new">0</span>
                                </button> <button class="reset-btn-new"><i class="fas fa-sync-alt"></i> Reset</button>
                            </div> <span class="target-count-new">Target: 33x</span>
                        </div>
                    </div>
                    <div class="dhikr-slide-new">
                        <div class="dhikr-progress"> <span class="progress-text">Dzikir 6 dari 7</span> <div class="progress-bar-container"> <div class="progress-bar-fill"></div> </div> </div>
                        <div class="dhikr-card-new">
                            <h3 class="dhikr-title-new">Penyempurna Seratus</h3> <p class="dhikr-arabic-new" style="font-size: 1.5rem; line-height: 1.8;">       ...</p> <p class="dhikr-translation-new">"Tidak ada ilah yang berhak disembah selain Allah semata..."</p>
                            <div class="counter-wrapper">
                                <button class="progress-counter" data-max="1" aria-label="Hitung Dzikir">
                                    <svg class="progress-ring" width="120" height="120"> <circle class="progress-ring__bg" stroke-width="6" fill="transparent" r="54" cx="60" cy="60"/> <circle class="progress-ring__circle" stroke-width="6" fill="transparent" r="54" cx="60" cy="60"/> </svg>
                                    <span class="count-display-new">0</span>
                                </button> <button class="reset-btn-new"><i class="fas fa-sync-alt"></i> Reset</button>
                            </div> <span class="target-count-new">Target: 1x</span>
                        </div>
                    </div>
                    <div class="dhikr-slide-new">
                        <div class="dhikr-progress"> <span class="progress-text">Dzikir 7 dari 7</span> <div class="progress-bar-container"> <div class="progress-bar-fill"></div> </div> </div>
                        <div class="dhikr-card-new">
                            <h3 class="dhikr-title-new">Membaca Ayat Kursi</h3> <p class="dhikr-arabic-new" style="font-size: 1.2rem; line-height: 2; text-align: justify;">      ...</p> <p class="dhikr-translation-new">"(Terjemahan Ayat Al-Kursi)"</p>
                            <div class="counter-wrapper">
                                <button class="progress-counter" data-max="1" aria-label="Hitung Dzikir">
                                    <svg class="progress-ring" width="120" height="120"> <circle class="progress-ring__bg" stroke-width="6" fill="transparent" r="54" cx="60" cy="60"/> <circle class="progress-ring__circle" stroke-width="6" fill="transparent" r="54" cx="60" cy="60"/> </svg>
                                    <span class="count-display-new">0</span>
                                </button> <button class="reset-btn-new"><i class="fas fa-sync-alt"></i> Reset</button>
                            </div> <span class="target-count-new">Target: 1x</span>
                        </div>
                    </div>
                </div>
                <button class="slider-nav-new prev"><i class="fas fa-chevron-left"></i></button>
                <button class="slider-nav-new next"><i class="fas fa-chevron-right"></i></button>
            </div>
        </section>

        <section id="tata-cara-sholat-section" class="content-section">
            <h2>Panduan Tata Cara Sholat</h2>
            <div class="prayer-guide-container">
                <div class="prayer-step"> <button class="step-header"> <span>1. Niat</span> <i class="fas fa-plus step-icon"></i> </button> <div class="step-content"> <div class="content-wrapper"> <p class="step-note">Niat sholat letaknya di dalam hati dan diucapkan bersamaan dengan Takbiratul Ihram. Lafadz niat tidak diucapkan lisan, namun cukup dihadirkan dalam hati sesuai dengan sholat yang akan dikerjakan (misalnya, "Saya niat sholat fardhu Subuh dua rakaat karena Allah Ta'ala").</p> </div> </div> </div>
                <div class="prayer-step"> <button class="step-header"> <span>2. Takbiratul Ihram</span> <i class="fas fa-plus step-icon"></i> </button> <div class="step-content"> <div class="content-wrapper"> <p class="arabic-text"> </p> <p class="transliteration-text">Allahu Akbar</p> <p class="translation-text">"Allah Maha Besar."</p> <p class="step-note">Mengangkat kedua tangan sejajar dengan bahu atau telinga, kemudian meletakkannya di dada dengan tangan kanan di atas tangan kiri.</p> </div> </div> </div>
                <div class="prayer-step"> <button class="step-header"> <span>3. Membaca Doa Iftitah</span> <i class="fas fa-plus step-icon"></i> </button> <div class="step-content"> <div class="content-wrapper"> <p class="arabic-text">         </p> <p class="transliteration-text">Allaahu akbar kabiraa walhamdulillaahi katsiiraa, wa subhaanallaahi bukratan wa'ashiilaa</p> <p class="translation-text">"Allah Maha Besar dengan sebesar-besarnya, segala puji bagi Allah dengan pujian yang banyak, dan Maha Suci Allah di waktu pagi dan petang."</p> </div> </div> </div>
                <div class="prayer-step"> <button class="step-header"> <span>4. Membaca Al-Fatihah</span> <i class="fas fa-plus step-icon"></i> </button> <div class="step-content"> <div class="content-wrapper"> <p class="arabic-text" style="font-size: 1.4rem; line-height: 2.2; text-align: justify;">   .    .  .   .    .   .         </p> <p class="step-note">Didahului dengan membaca Ta'awudz: "A'uudzu billaahi minasy-syaithaanir-rajiim" (Aku berlindung kepada Allah dari godaan setan yang terkutuk).</p> </div> </div> </div>
                <div class="prayer-step"> <button class="step-header"> <span>5. Ruku'</span> <i class="fas fa-plus step-icon"></i> </button> <div class="step-content"> <div class="content-wrapper"> <p class="arabic-text">   </p> <p class="transliteration-text">Subhaana robbiyal 'adziimi wa bihamdih (3x)</p> <p class="translation-text">"Maha Suci Tuhanku yang Maha Agung dan dengan memuji-Nya." (Dibaca 3 kali)</p> </div> </div> </div>
                <div class="prayer-step"> <button class="step-header"> <span>6. I'tidal (Bangkit dari Ruku')</span> <i class="fas fa-plus step-icon"></i> </button> <div class="step-content"> <div class="content-wrapper"> <p class="arabic-text">   </p> <p class="transliteration-text">Sami'allaahu liman hamidah</p> <p class="translation-text">"Allah Maha Mendengar orang yang memuji-Nya."</p> <hr style="border-color: var(--border-color); margin: 1rem 0;"> <p class="arabic-text">            </p> <p class="transliteration-text">Robbanaa lakal hamdu mil'us samaawaati wa mil'ul ardhi wa mil'u maa syi'ta min syai'in ba'du</p> <p class="translation-text">"Ya Tuhan kami, bagi-Mu segala puji, sepenuh langit dan sepenuh bumi, dan sepenuh apa yang Engkau kehendaki setelah itu."</p> </div> </div> </div>
                <div class="prayer-step"> <button class="step-header"> <span>7. Sujud</span> <i class="fas fa-plus step-icon"></i> </button> <div class="step-content"> <div class="content-wrapper"> <p class="arabic-text">   </p> <p class="transliteration-text">Subhaana robbiyal a'laa wa bihamdih (3x)</p> <p class="translation-text">"Maha Suci Tuhanku Yang Maha Tinggi dan dengan memuji-Nya." (Dibaca 3 kali)</p> </div> </div> </div>
                <div class="prayer-step"> <button class="step-header"> <span>8. Duduk di Antara Dua Sujud</span> <i class="fas fa-plus step-icon"></i> </button> <div class="step-content"> <div class="content-wrapper"> <p class="arabic-text">          </p> <p class="transliteration-text">Robbighfirlii warhamnii wajburnii warfa'nii warzuqnii wahdinii wa'aafinii wa'fu 'annii</p> <p class="translation-text">"Ya Tuhanku, ampunilah aku, rahmatilah aku, cukupkanlah aku, angkatlah derajatku, berilah aku rezeki, berilah aku petunjuk, sehatkanlah aku, dan maafkanlah aku."</p> </div> </div> </div>
                <div class="prayer-step"> <button class="step-header"> <span>9. Tasyahud Akhir</span> <i class="fas fa-plus step-icon"></i> </button> 
                    <div class="step-content"> 
                        <div class="content-wrapper"> 
                            <p class="arabic-text" style="font-size: 1.4rem; line-height: 2.2;">                                                                    </p> 
                            <p class="step-note">Untuk Tasyahud Awal (pada sholat Dzuhur, Ashar, Maghrib, Isya), bacaan hanya sampai "wa asyhadu anna Muhammadar rasuulullah".</p> 
                        </div> 
                    </div> 
                </div>
                <div class="prayer-step"> <button class="step-header"> <span>10. Salam</span> <i class="fas fa-plus step-icon"></i> </button> <div class="step-content"> <div class="content-wrapper"> <p class="arabic-text">   </p> <p class="transliteration-text">Assalaamu 'alaikum wa rahmatullah</p> <p class="translation-text">"Keselamatan dan rahmat Allah semoga tercurah atas kalian."</p> <p class="step-note">Mengucapkan salam sambil menoleh ke kanan, kemudian menoleh ke kiri.</p> </div> </div> </div>
            </div>
        </section>

        <section id="quran-section" class="content-section">
            <h2>Al-Qur'an Digital</h2>
            
            <div id="quran-container">
                <div id="surah-list-container">
                    <div id="surah-list-loading" style="text-align: center; padding: 2rem;">
                        <i class="fas fa-spinner fa-spin" style="font-size: 2rem; color: var(--primary-color);"></i>
                        <p style="margin-top: 1rem;">Memuat daftar surah...</p>
                    </div>
                    <div id="surah-list-content"></div>
                </div>
        
                <div id="surah-detail-container" style="display: none;">
                    <button id="back-to-surah-list-btn" class="popup-btn secondary" style="margin-bottom: 1.5rem; border: 2px solid var(--border-color);"><i class="fas fa-arrow-left"></i> Kembali ke Daftar</button>
                    
<div id="surah-detail-header">
    <h3 id="surah-detail-title"></h3>
    <p id="surah-detail-info"></p>
    <button id="quran-autoplay-toggle" class="popup-btn secondary" style="margin-top: 1rem; padding: 0.6rem 1rem; font-size: 0.9rem; border-width: 2px;">
        <i class="fas fa-forward"></i> 
        <span>Autoplay: Mati</span>
    </button>
    
    <div id="quran-display-toggles">
        <button id="quran-toggle-translation" class="toggle-btn active" data-target="verse-translation">Terjemahan</button>
        <button id="quran-toggle-transliteration" class="toggle-btn" data-target="verse-transliteration">Transliterasi</button>
    </div>
</div>

                    <div id="surah-detail-loading" style="text-align: center; padding: 2rem;">
                         <i class="fas fa-spinner fa-spin" style="font-size: 2rem; color: var(--primary-color);"></i>
                         <p style="margin-top: 1rem;">Memuat ayat...</p>
                    </div>

                    <div id="surah-detail-content"></div>
                </div>
            </div>
        </section>

        <section id="doa-nabi-section" class="content-section">
            <h2>Kumpulan Doa Para Nabi</h2>
            <div class="prayer-guide-container">
                <div class="prayer-step"> <button class="step-header"> <span>Doa Nabi Adam AS</span> <i class="fas fa-plus step-icon"></i> </button> <div class="step-content"> <div class="content-wrapper"> <p class="arabic-text">          </p> <p class="transliteration-text">Robbanaa zholamnaa anfusanaa wa illam taghfirlanaa wa tarhamnaa lanakuunanna minal khoosiriin.</p> <p class="translation-text">"Ya Tuhan kami, kami telah menzalimi diri kami sendiri. Jika Engkau tidak mengampuni kami dan memberi rahmat kepada kami, niscaya kami termasuk orang-orang yang rugi."</p> <p class="step-note">QS. Al-A'raf: 23</p> </div> </div> </div>
                <div class="prayer-step"> <button class="step-header"> <span>Doa Nabi Nuh AS</span> <i class="fas fa-plus step-icon"></i> </button> <div class="step-content"> <div class="content-wrapper"> <p class="arabic-text">                  </p> <p class="transliteration-text">Rabbi inn a'u bika an as`alaka m laisa l bih 'ilm, wa ill tagfirl wa tar-amn akum minal-khsirn.</p> <p class="translation-text">"Ya Tuhanku, sesungguhnya aku berlindung kepada-Mu untuk memohon sesuatu yang aku tidak mengetahui (hakikatnya). Kalau Engkau tidak mengampuniku dan menaruh belas kasihan kepadaku, niscaya aku termasuk orang yang rugi."</p> <p class="step-note">QS. Hud: 47</p> </div> </div> </div>
                <div class="prayer-step"> <button class="step-header"> <span>Doa Nabi Ibrahim AS</span> <i class="fas fa-plus step-icon"></i> </button> <div class="step-content"> <div class="content-wrapper"> <p class="arabic-text">    </p> <p class="transliteration-text">Rabbi hab l mina-lin.</p> <p class="translation-text">"Ya Tuhanku, anugerahkanlah kepadaku (seorang anak) yang termasuk orang yang saleh."</p> <p class="step-note">QS. As-Saffat: 100</p> </div> </div> </div>
                <div class="prayer-step"> <button class="step-header"> <span>Doa Nabi Yunus AS</span> <i class="fas fa-plus step-icon"></i> </button> <div class="step-content"> <div class="content-wrapper"> <p class="arabic-text">        </p> <p class="transliteration-text">L ilha ill anta sub-naka inn kuntu mina-limn.</p> <p class="translation-text">"Tidak ada tuhan selain Engkau, Mahasuci Engkau. Sungguh, aku termasuk orang-orang yang zalim."</p> <p class="step-note">QS. Al-Anbiya: 87</p> </div> </div> </div>
                <div class="prayer-step"> <button class="step-header"> <span>Doa Nabi Musa AS</span> <i class="fas fa-plus step-icon"></i> </button> <div class="step-content"> <div class="content-wrapper"> <p class="arabic-text">            </p> <p class="transliteration-text">Rabbisyra l adr wa yassir l amr walul 'uqdatam mil lisn yafqah qaul.</p> <p class="translation-text">"Ya Tuhanku, lapangkanlah dadaku, dan mudahkanlah untukku urusanku, dan lepaskanlah kekakuan dari lidahku, agar mereka mengerti perkataanku."</p> <p class="step-note">QS. Taha: 25-28</p> </div> </div> </div>
                <div class="prayer-step"> <button class="step-header"> <span>Doa Nabi Ayyub AS</span> <i class="fas fa-plus step-icon"></i> </button> <div class="step-content"> <div class="content-wrapper"> <p class="arabic-text">     </p> <p class="transliteration-text">Ann massaniya-urru wa anta ar-amur-rimn.</p> <p class="translation-text">"(Ya Tuhanku), sesungguhnya aku telah ditimpa penyakit dan Engkau adalah Tuhan Yang Maha Penyayang di antara semua penyayang."</p> <p class="step-note">QS. Al-Anbiya: 83</p> </div> </div> </div>
            </div>
        </section>

        <section id="kiblat-section" class="content-section">
            <h2>Arah Kiblat</h2>
            <div class="kiblat-container">
                <div id="kiblat-permission-prompt">
                    <p>Fitur ini memerlukan izin akses lokasi dan sensor gerak untuk menentukan arah Kiblat secara akurat.</p>
                    <button id="kiblat-permission-btn">Izinkan & Mulai</button>
                </div>

                <div class="compass-ui-container" style="display: none;">
                    <div class="compass" id="compass-container">
                        <div class="compass-circle" id="qibla-compass-circle">
                            <div class="compass-rose" id="compass-rose">
                                <div class="degree-mark north">U</div>
                                <div class="degree-mark east">T</div>
                                <div class="degree-mark south">S</div>
                                <div class="degree-mark west">B</div>
                            </div>
                            <div class="qibla-pointer" id="qibla-pointer">
                                <div class="kaaba-icon"></div>
                            </div>
                            <div class="lubber-line"></div>
                        </div>
                    </div>
                    <div class="kiblat-info-box">
                        <p class="direction-degree">Mencari lokasi...</p>
                        <p class="calibration-info">Arahkan ponsel ke depan dan putar hingga ikon Ka'bah  sejajar dengan garis merah di atas.</p>
                    </div>
                </div>
            </div>
        </section>

        <section id="doa-harian-section" class="content-section">
            <h2>Doa Sehari-hari</h2>
            <div class="prayer-guide-container">
                <div class="prayer-step">
                    <button class="step-header"> <span>Doa Sebelum Tidur</span> <i class="fas fa-plus step-icon"></i> </button>
                    <div class="step-content">
                        <div class="content-wrapper">
                            <p class="arabic-text">    </p>
                            <p class="transliteration-text">Bismikallahumma ahya wa bismika amuut.</p>
                            <p class="translation-text">"Dengan nama-Mu ya Allah aku hidup dan dengan nama-Mu aku mati."</p>
                            <p class="step-note">HR. Bukhari dan Muslim</p>
                        </div>
                    </div>
                </div>
                <div class="prayer-step">
                    <button class="step-header"> <span>Doa Bangun Tidur</span> <i class="fas fa-plus step-icon"></i> </button>
                    <div class="step-content">
                        <div class="content-wrapper">
                            <p class="arabic-text">        </p>
                            <p class="transliteration-text">Alhamdulillahilladzi ahyaanaa ba'da maa amaatanaa wa ilaihin nusyuur.</p>
                            <p class="translation-text">"Segala puji bagi Allah yang telah menghidupkan kami sesudah kami mati (tidur) dan kepada-Nya kami dikembalikan."</p>
                            <p class="step-note">HR. Bukhari</p>
                        </div>
                    </div>
                </div>
                <div class="prayer-step">
                    <button class="step-header"> <span>Doa Masuk Kamar Mandi</span> <i class="fas fa-plus step-icon"></i> </button>
                    <div class="step-content">
                        <div class="content-wrapper">
                            <p class="arabic-text">      </p>
                            <p class="transliteration-text">Allahumma inni a'udzubika minal khubutsi wal khabaaits.</p>
                            <p class="translation-text">"Ya Allah, aku berlindung kepada-Mu dari godaan setan jantan dan setan betina."</p>
                            <p class="step-note">HR. Bukhari dan Muslim</p>
                        </div>
                    </div>
                </div>
                <div class="prayer-step">
                    <button class="step-header"> <span>Doa Keluar Kamar Mandi</span> <i class="fas fa-plus step-icon"></i> </button>
                    <div class="step-content">
                        <div class="content-wrapper">
                            <p class="arabic-text"></p>
                            <p class="transliteration-text">Ghufronaka.</p>
                            <p class="translation-text">"Aku memohon ampunan-Mu."</p>
                            <p class="step-note">HR. Tirmidzi, Abu Dawud, Ibnu Majah</p>
                        </div>
                    </div>
                </div>
                <div class="prayer-step">
                    <button class="step-header"> <span>Doa Sebelum Makan</span> <i class="fas fa-plus step-icon"></i> </button>
                    <div class="step-content">
                        <div class="content-wrapper">
                            <p class="arabic-text">       </p>
                            <p class="transliteration-text">Allahumma baarik lanaa fiimaa rozaqtanaa wa qinaa 'adzaaban naar.</p>
                            <p class="translation-text">"Ya Allah, berkahilah kami dalam rezeki yang telah Engkau berikan kepada kami dan peliharalah kami dari siksa api neraka."</p>
                            <p class="step-note">Jika lupa di awal, baca: "Bismillaahi awwalahu wa aakhirohu" (Dengan nama Allah di awal dan di akhirnya).</p>
                        </div>
                    </div>
                </div>
                <div class="prayer-step">
                    <button class="step-header"> <span>Doa Sesudah Makan</span> <i class="fas fa-plus step-icon"></i> </button>
                    <div class="step-content">
                        <div class="content-wrapper">
                            <p class="arabic-text">       </p>
                            <p class="transliteration-text">Alhamdulillahilladzi ath'amanaa wa saqoonaa wa ja'alanaa minal muslimiin.</p>
                            <p class="translation-text">"Segala puji bagi Allah yang telah memberi kami makan dan minum, serta menjadikan kami termasuk golongan orang-orang muslim."</p>
                            <p class="step-note">HR. Abu Dawud, Tirmidzi, Ibnu Majah</p>
                        </div>
                    </div>
                </div>
                 <div class="prayer-step">
                    <button class="step-header"> <span>Doa Keluar Rumah</span> <i class="fas fa-plus step-icon"></i> </button>
                    <div class="step-content">
                        <div class="content-wrapper">
                            <p class="arabic-text">          </p>
                            <p class="transliteration-text">Bismillahi, tawakkaltu 'alallah, laa haula wa laa quwwata illaa billaah.</p>
                            <p class="translation-text">"Dengan nama Allah, aku bertawakal kepada Allah. Tiada daya dan kekuatan kecuali dengan Allah."</p>
                            <p class="step-note">HR. Abu Dawud, Tirmidzi</p>
                        </div>
                    </div>
                </div>
                <div class="prayer-step">
                    <button class="step-header"> <span>Doa Masuk Rumah</span> <i class="fas fa-plus step-icon"></i> </button>
                    <div class="step-content">
                        <div class="content-wrapper">
                            <p class="arabic-text">         </p>
                            <p class="transliteration-text">Bismillahi walajnaa, wa bismillahi kharajnaa, wa 'alallahi rabbina tawakkalnaa.</p>
                            <p class="translation-text">"Dengan nama Allah kami masuk, dengan nama Allah kami keluar, dan hanya kepada Allah Tuhan kami, kami bertawakal."</p>
                            <p class="step-note">HR. Abu Dawud. Kemudian ucapkan salam.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="tasbih-digital-section" class="content-section">
            <h2>Penghitung Digital</h2>
            <div class="tasbih-container">
                <div id="tasbih-setup" class="tasbih-setup-container">
                    <div class="tasbih-form-group">
                        <select id="dzikir-select">
                            <option value="" disabled selected>Pilih Dzikir</option>
                            <option value="Subhanallah">Subhanallah</option>
                            <option value="Alhamdulillah">Alhamdulillah</option>
                            <option value="Allahu Akbar">Allahu Akbar</option>
                            <option value="Laa ilaha illallah">Laa ilaha illallah</option>
                            <option value="Astaghfirullah">Astaghfirullah</option>
                            <option value="custom">Isi Sendiri</option>
                        </select>
                    </div>
                    <div class="tasbih-form-group">
                         <input type="text" id="custom-dzikir-input" placeholder="Ketik dzikir di sini" style="display: none;">
                    </div>
                    <div class="tasbih-form-group">
                        <input type="number" id="dzikir-target" placeholder="Jumlah Dzikir">
                    </div>
                    <button id="start-tasbih-btn" class="tasbih-btn">Mulai</button>
                </div>
        
                <div id="tasbih-counter" class="tasbih-counter-container" style="display: none;">
                    <h3 id="display-dzikir-text"></h3>
                    <p id="display-dzikir-target"></p>
                    <div class="counter-ui">
                        <button id="reset-count-btn" class="tasbih-control-btn"><i class="fas fa-sync-alt"></i></button>
                        <span id="tasbih-count-display">0</span>
                        <button id="increment-tasbih-btn" class="tasbih-control-btn"><i class="fas fa-plus"></i></button>
                    </div>
                    <a href="#" id="reset-setup-link">Reset Penghitung</a>
                </div>
            </div>
        </section>

        <section id="penjelasan-section" class="content-section">
            <h2>Mengenal Zikir</h2>
            <div class="explanation-container">
                <p>Zikir (bahasa Arab: ) secara harfiah berarti mengingat, menyebut, atau mengenang. Dalam konteks Islam, zikir adalah aktivitas mengingat Allah SWT dengan mengucapkan kalimat-kalimat suci dan nama-nama-Nya.</p>
                <p>Zikir dapat dilakukan kapan saja dan di mana saja, baik secara lisan maupun dalam hati. Amalan ini memiliki banyak manfaat, antara lain menenangkan hati, menghapus dosa, dan meningkatkan kedekatan seorang hamba dengan Tuhannya.</p>
                <p>Rasulullah SAW bersabda, "Tiada suatu amalan pun yang lebih menyelamatkan dari azab Allah daripada zikir kepada Allah." (HR. Ahmad dan Tirmidzi).</p>
                <p>Dengan rutin berzikir, seorang muslim akan senantiasa merasakan kehadiran Allah, menemukan ketenangan jiwa, dan memperkuat keimanannya. Ini adalah salah satu bentuk ibadah yang paling mudah namun memiliki ganjaran yang besar di sisi Allah.</p>
            </div>
        </section>

        <section id="pengaturan-section" class="content-section">
            <h2>Pengaturan Aplikasi</h2>
            <div class="settings-container">
                <h4 class="settings-list-title">Tampilan</h4>
                <ul class="settings-list">
                    <li class="settings-item">
                        <div class="setting-label">Mode Otomatis</div>
                        <label class="switch"><input type="checkbox" id="auto-mode-toggle"><span class="slider"></span></label>
                    </li>
                    <li class="settings-item">
                        <div class="setting-label">Mode Malam Manual</div>
                        <label class="switch"><input type="checkbox" id="dark-mode-toggle"><span class="slider"></span></label>
                    </li>
                </ul>
<h4 class="settings-list-title">Notifikasi & Izin</h4>
<li class="settings-item" style="display: block;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
        <div class="setting-label">Akses Lokasi</div>
        <label class="switch"><input type="checkbox" id="location-access-toggle"><span class="slider"></span></label>
    </div>
    
    <button id="manual-refresh-loc-btn" class="popup-btn secondary" style="width: 100%; font-size: 0.9rem; padding: 0.6rem; border: 1px dashed var(--icon-color); color: var(--text-color); display: flex; justify-content: center; align-items: center; gap: 8px;">
        <i class="fas fa-sync-alt"></i> <span>Perbarui Lokasi/Jadwal</span>
    </button>
    <small id="refresh-status-text" style="display: block; text-align: center; font-size: 0.75rem; color: var(--primary-color); margin-top: 5px; height: 1rem;"></small>
</li>
<li class="settings-item" style="display: block;">
    <div style="display: flex; justify-content: space-between; align-items: center;">
        <div style="display: flex; flex-direction: column; gap: 0.2rem;">
            <div class="setting-label" style="font-weight: 700;">Izinkan Pop Up Alarm</div>
            <small style="font-size: 0.8rem; color: var(--icon-color); line-height: 1.3;">
                Layar Azan akan muncul saat alarm berbunyi di atas aplikasi lain.
            </small>
        </div>
        <label class="switch">
            <input type="checkbox" id="popup-toggle">
            <span class="slider"></span>
        </label>
    </div>
</li>
                    
                    <li class="settings-item">
                        <div class="setting-label">Notifikasi Adzan</div>
                        <label class="switch"><input type="checkbox" id="notification-toggle"><span class="slider"></span></label>
                    </li>

                    <li class="settings-item">
                        <div class="setting-label">Notifikasi  Motivasi Islami</div>
                        <label class="switch"><input type="checkbox" id="motivation-toggle"><span class="slider"></span></label>
                    </li>
                </ul>

                <h4 class="settings-list-title">Izin Sistem (Wajib Diatur)</h4>
                <ul class="settings-list">
                    <li class="settings-item" style="display: block;">
                        <div style="margin-bottom: 1rem;">
                            <p style="font-size: 0.9rem; margin-bottom: 0.5rem;">Jika Alarm/Notifikasi tidak bunyi, mohon izinkan <b>"Alarm & Reminders"</b> dan <b>"Notifications"</b> di pengaturan sistem.</p>
                            
                            <button id="open-system-settings-btn" class="popup-btn secondary" style="width: 100%; border: 1px solid var(--primary-color); color: var(--primary-color); padding: 0.8rem;">
                                <i class="fas fa-cog fa-spin" style="animation-duration: 3s;"></i> Buka Pengaturan HP
                            </button>
                        </div>
                    
                <h4 class="settings-list-title">Informasi</h4>
                <ul class="settings-list">
                    <li class="settings-item"><a href="#kebijakan-privasi" class="nav-shortcut"><div class="setting-label">Kebijakan Privasi</div><i class="fas fa-chevron-right chevron-icon" aria-hidden="true"></i></a></li>
                    <li class="settings-item"><a href="#ketentuan-penggunaan" class="nav-shortcut"><div class="setting-label">Ketentuan Penggunaan</div><i class="fas fa-chevron-right chevron-icon" aria-hidden="true"></i></a></li>
                    <li class="settings-item"><a href="#saran-masukan" class="nav-shortcut"><div class="setting-label">Saran & Masukan</div><i class="fas fa-chevron-right chevron-icon" aria-hidden="true"></i></a></li>
                    <li class="settings-item"><div class="setting-label">Versi Aplikasi</div><div class="setting-value">v1.2.0 (27)</div></li>
                </ul>
            </div>
            <a href="#" class="store-button"><i class="fab fa-google-play" aria-hidden="true"></i> Unduh di Google PlayStore</a>
        </section>

        <section id="kebijakan-privasi-section" class="content-section">
            <h2>Kebijakan Privasi</h2>
            <div class="explanation-container">
                <p><strong>Terakhir Diperbarui:</strong> 5 September 2025</p>
                <p>Kami di ZikirNur ("kami", "milik kami", atau "kita") menghargai privasi Anda. Kebijakan Privasi ini menjelaskan bagaimana kami mengumpulkan, menggunakan, dan melindungi informasi Anda saat Anda menggunakan aplikasi kami.</p>
                
                <h4>Informasi yang Kami Kumpulkan</h4>
                <ul>
                    <li><strong>Data Lokasi:</strong> Kami meminta akses ke lokasi geografis Anda (latitude dan longitude) untuk memberikan fitur inti seperti waktu sholat dan arah Kiblat yang akurat. Data ini hanya digunakan saat aplikasi aktif dan tidak disimpan secara permanen di server kami.</li>
                    <li><strong>Data Penggunaan Non-Pribadi:</strong> Kami dapat mengumpulkan informasi anonim tentang bagaimana Anda berinteraksi dengan aplikasi (misalnya, fitur yang paling sering digunakan) untuk membantu kami meningkatkan layanan.</li>
                </ul>
    
                <h4>Bagaimana Kami Menggunakan Informasi Anda</h4>
                <ul>
                    <li>Menyediakan dan memelihara fungsionalitas aplikasi.</li>
                    <li>Menampilkan waktu sholat dan arah Kiblat yang akurat berdasarkan lokasi Anda.</li>
                    <li>Mengirimkan notifikasi adzan jika Anda mengizinkannya.</li>
                    <li>Memahami bagaimana pengguna menggunakan aplikasi kami untuk tujuan perbaikan dan pengembangan.</li>
                </ul>
    
                <h4>Berbagi Informasi</h4>
                <p>Kami tidak menjual, memperdagangkan, atau menyewakan informasi identifikasi pribadi Anda kepada pihak lain. Data lokasi Anda dapat dibagikan dengan penyedia layanan pihak ketiga (API waktu sholat) hanya untuk tujuan menyediakan layanan dalam aplikasi.</p>
    
                <h4>Keamanan</h4>
                <p>Kami berkomitmen untuk melindungi data Anda. Namun, perlu diingat bahwa tidak ada metode transmisi melalui internet atau metode penyimpanan elektronik yang 100% aman.</p>
    
                <h4>Perubahan pada Kebijakan Ini</h4>
                <p>Kami dapat memperbarui Kebijakan Privasi kami dari waktu ke waktu. Kami akan memberitahu Anda tentang perubahan apa pun dengan memposting Kebijakan Privasi baru di halaman ini.</p>
    
                <h4>Hubungi Kami</h4>
                <p>Jika Anda memiliki pertanyaan tentang Kebijakan Privasi ini, silakan hubungi kami di: <a href="mailto:dukungan.zikirnur@email.com" style="color: var(--primary-color);">dukungan.zikirnur@email.com</a>.</p>
            </div>
        </section>
        
        <section id="ketentuan-penggunaan-section" class="content-section">
            <h2>Ketentuan Penggunaan</h2>
            <div class="explanation-container">
                <p><strong>Terakhir Diperbarui:</strong> 5 September 2025</p>
                <p>Selamat datang di ZikirNur. Dengan mengunduh, mengakses, atau menggunakan aplikasi kami, Anda setuju untuk terikat oleh Ketentuan Penggunaan ini.</p>
                
                <h4>1. Penggunaan Aplikasi</h4>
                <p>Aplikasi ZikirNur disediakan untuk penggunaan pribadi dan non-komersial Anda. Anda setuju untuk tidak menggunakan aplikasi untuk tujuan apa pun yang melanggar hukum atau dilarang oleh ketentuan ini.</p>
                
                <h4>2. Akurasi Informasi</h4>
                <p>Kami berusaha untuk memberikan informasi yang seakurat mungkin, termasuk waktu sholat dan arah Kiblat. Namun, kami tidak menjamin keakuratan, kelengkapan, atau keandalan informasi apa pun. Anda bertanggung jawab untuk memverifikasi informasi penting secara mandiri.</p>
                
                <h4>3. Batasan Tanggung Jawab</h4>
                <p>Dalam batas yang diizinkan oleh hukum, ZikirNur tidak akan bertanggung jawab atas kerusakan langsung, tidak langsung, insidental, atau konsekuensial yang timbul dari penggunaan atau ketidakmampuan untuk menggunakan aplikasi ini.</p>
                
                <h4>4. Perubahan Ketentuan</h4>
                <p>Kami berhak untuk mengubah Ketentuan Penggunaan ini kapan saja. Penggunaan Anda yang berkelanjutan atas aplikasi setelah perubahan tersebut merupakan penerimaan Anda terhadap ketentuan baru.</p>
            </div>
        </section>

        <section id="saran-masukan-section" class="content-section">
            <h2>Saran & Masukan</h2>
            <div class="explanation-container" style="text-align: center; padding-top: 2rem;">
                <p style="font-size: 1.1rem; margin-bottom: 1rem;">Kami sangat menghargai setiap masukan dari Anda untuk menjadikan ZikirNur lebih baik.</p>
                <p>Apakah Anda menemukan bug, memiliki ide untuk fitur baru, atau hanya ingin menyapa? Jangan ragu untuk menghubungi kami!</p>
                <a href="mailto:zikirn23@gmail.com" class="survey-button" style="margin-top: 2rem; text-decoration: none;">
                    <i class="fas fa-envelope"></i> Kirim Email kepada Kami
                </a>
                <p style="margin-top: 2rem; color: var(--icon-color);">Setiap saran Anda sangat berarti bagi pengembangan aplikasi ini ke depannya. Terima kasih telah menjadi bagian dari perjalanan ZikirNur.</p>
            </div>
        </section>

    </main>

    <audio id="global-quran-player"></audio>

    <div id="permission-popup" class="popup-overlay">
        <div class="popup-content">
            <div id="popup-icon-container" class="popup-icon"></div>
            <h3 id="popup-title" class="popup-title"></h3>
            <p id="popup-message" class="popup-message"></p>
            <div class="popup-actions">
                <button id="popup-deny-btn" class="popup-btn secondary">Tolak</button>
                <button id="popup-allow-btn" class="popup-btn primary">Izinkan</button>
            </div>
        </div>
    </div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

<script>

// --- KONFIGURASI GLOBAL ---
let todayPrayerTimes = {};
let globalAudioPlayer;
let currentPlayingButton = null;
let allSurahsData = []; 
let dhikrCounts = []; 
let isQuranAutoplayActive = false;
let currentAudioSrc = null;
let currentSurahNumber = null;
// Variabel bantu scroll
let lastActiveVerseId = null;

// =====================================================================
// 1. LOGIKA SYSTEM & PERMISSION (ANDROID BRIDGE)
// =====================================================================

// Sinkronisasi Izin Pop-Up (Display over other apps)
function syncOverlayPermission() {
    const popupToggle = document.getElementById('popup-toggle');
    if (popupToggle && window.Android && typeof window.Android.checkOverlayPermission === 'function') {
        const isGranted = window.Android.checkOverlayPermission();
        popupToggle.checked = isGranted; 
        console.log("Sinkronisasi Izin Pop-Up: " + (isGranted ? "DIIZINKAN" : "DITOLAK"));
    }
}

document.addEventListener('DOMContentLoaded', syncOverlayPermission);

document.addEventListener("visibilitychange", () => {
    if (document.visibilityState === "visible") syncOverlayPermission();
});
window.addEventListener("focus", syncOverlayPermission);

// Event Listener Toggle Pop-Up
const popupToggleBtn = document.getElementById('popup-toggle');
if (popupToggleBtn) {
    popupToggleBtn.addEventListener('change', (e) => {
        if (e.target.checked) {
            if (window.Android && typeof window.Android.requestOverlayPermission === 'function') {
                const isGranted = window.Android.checkOverlayPermission();
                if (!isGranted) window.Android.requestOverlayPermission();
            } else {
                alert("Fitur ini hanya berfungsi di dalam Aplikasi Android.");
                e.target.checked = false;
            }
        } else {
            if (window.Android) {
                  alert("Untuk mematikan fitur ini sepenuhnya, harap matikan izin 'Muncul di atas' di pengaturan HP secara manual.");
            }
        }
    });
}

// Anti Klik Kanan & Shortcut
document.addEventListener('contextmenu', e => e.preventDefault());
document.onkeydown = function(e) {
    if (event.keyCode == 123) return false; // F12
    if (e.ctrlKey && e.shiftKey && (e.keyCode == 'I'.charCodeAt(0) || e.keyCode == 'C'.charCodeAt(0) || e.keyCode == 'J'.charCodeAt(0))) return false;
    if (e.ctrlKey && (e.keyCode == 'U'.charCodeAt(0) || e.keyCode == 'S'.charCodeAt(0) || e.keyCode == 'C'.charCodeAt(0))) return false;
};


// =====================================================================
// 2. [UPDATED] LOGIKA SCROLL & AUDIO CALLBACK
// =====================================================================

// Fungsi Scroll Manual (Lebih stabil di WebView daripada scrollIntoView)
function scrollToActiveVerse(elementId) {
    const element = document.getElementById(elementId);
    if (!element) return;

    // Hapus highlight lama
    const oldActive = document.querySelector('.active-highlight');
    if (oldActive) oldActive.classList.remove('active-highlight');

    // Tambah highlight baru
    element.classList.add('active-highlight');

    // Hitung posisi tengah (Center Screen)
    setTimeout(() => {
        const elementRect = element.getBoundingClientRect();
        const absoluteElementTop = elementRect.top + window.pageYOffset;
        const middle = absoluteElementTop - (window.innerHeight / 2) + (elementRect.height / 2);

        window.scrollTo({
            top: middle,
            behavior: 'smooth' 
        });
    }, 100);
}

// Callback Audio Selesai (Dipanggil oleh Android / Browser Player)
window.onAudioFinished = function() {
    console.log("JS: Audio Selesai (onAudioFinished trigged).");
    
    // Reset Tombol Lama
    if (window.currentPlayingButton) {
        window.currentPlayingButton.classList.remove('playing');
        window.currentPlayingButton.classList.remove('loading');
    }

    // Logika Autoplay Quran
    if (isQuranAutoplayActive && window.currentPlayingButton) {
        const currentVerseItem = window.currentPlayingButton.closest('.verse-item');
        
        if (currentVerseItem) {
            let nextVerseItem = currentVerseItem.nextElementSibling;
            
            // A. LANJUT AYAT (Dalam Surat Sama)
            if (nextVerseItem && nextVerseItem.classList.contains('verse-item')) {
                const nextPlayButton = nextVerseItem.querySelector('.audio-control-btn');
                if (nextPlayButton) {
                    nextPlayButton.click(); 
                }
            } 
            // B. GANTI SURAT (Next Surah)
            else {
                const nextSurahNum = (parseInt(currentSurahNumber) || 0) + 1;
                
                if (nextSurahNum <= 114) {
                    if(window.Android && window.Android.showToast) {
                        window.Android.showToast(`Lanjut ke Surat ke-${nextSurahNum}...`);
                    }
                    // Panggil load surah dengan Autoplay = TRUE
                    loadSurahDetail(nextSurahNum, true); 
                } else {
                    console.log("Khatam.");
                    stopQuranAutoplay();
                }
            }
        }
    }
    
    // Reset tombol Dzikir Dashboard
    if(typeof window.resetDzikirButtons === 'function') window.resetDzikirButtons();
};


// =====================================================================
// 3. INIT APLIKASI UTAMA
// =====================================================================

document.addEventListener('DOMContentLoaded', () => {
    
    // Cache Elemen
    const elements = {
        openSidebarBtn: document.getElementById('openSidebarBtn'),
        sidebar: document.getElementById('mySidebar'),
        sidebarOverlay: document.getElementById('sidebarOverlay'),
        navLinks: document.querySelectorAll('.nav-link'),
        shortcutLinks: document.querySelectorAll('.nav-shortcut'),
        sections: document.querySelectorAll('.content-section'),
        darkModeToggle: document.getElementById('dark-mode-toggle'),
        autoModeToggle: document.getElementById('auto-mode-toggle'),
        darkModeIcon: document.getElementById('darkModeIcon'),
        locationToggle: document.getElementById('location-access-toggle'),
        notificationToggle: document.getElementById('notification-toggle'),
        soundToggle: document.getElementById('sound-toggle'),
        locationDisplay: document.querySelector('.card-location'),
        refreshLocationBtn: document.getElementById('refresh-location-btn'),
        infoToSettingsBtn: document.getElementById('infoToSettingsBtn'),
        popup: document.getElementById('permission-popup'),
        popupIcon: document.getElementById('popup-icon-container'),
        popupTitle: document.getElementById('popup-title'),
        popupMessage: document.getElementById('popup-message'),
        popupAllowBtn: document.getElementById('popup-allow-btn'),
        popupDenyBtn: document.getElementById('popup-deny-btn'),
        prayerTimeCard: document.querySelector('.prayer-time-card'),
        motivasiTextEl: document.getElementById('motivasi-realtime'),
        motivasiTimeEl: document.getElementById('motivasi-timestamp'),
        globalAudioPlayerEl: document.getElementById('global-quran-player')
    };
    
    globalAudioPlayer = elements.globalAudioPlayerEl;
    window.globalAudioPlayer = globalAudioPlayer;

    // Init Modules
    initSidebar(elements);
    initNavigation(elements);
    initInfoToSettings(elements);
    initDarkMode(elements);
    initPopupLogic(elements);
    initAppSettingsAndData(elements); // Prayer Times & Loc
    initDashboardAudio(elements);     // Dzikir Pagi Petang
    initDhikrSlider();                // Slider Dzikir
    initAccordions();                 // Bacaan Sholat
    setupQiblaFeature();
    setupTasbihDigital();
    setupButtonSlider();
    initFirebaseMotivasi(elements);
    
    // Init Quran
    initQuranFeature(); 
    loadSurahList(); // Load daftar surat awal

    // Loop Highlight Sholat
    setInterval(highlightNextPrayer, 30000);
});


// =====================================================================
// 4. MODUL FITUR (Navigasi, UI, Firebase)
// =====================================================================

function initFirebaseMotivasi(elements) {
    const { motivasiTextEl, motivasiTimeEl } = elements;
    if (!motivasiTextEl) return;

    if(motivasiTimeEl) motivasiTimeEl.style.display = 'none';

    if (window.Android && typeof window.Android.getSavedMotivation === 'function') {
        try {
            const savedMotivation = window.Android.getSavedMotivation();
            motivasiTextEl.textContent = savedMotivation;
        } catch (e) {
            motivasiTextEl.textContent = 'Gagal memuat motivasi.';
        }
    } else {
        motivasiTextEl.textContent = 'Fitur motivasi khusus aplikasi Android.';
    }
}

function initSidebar(elements) {
    const { openSidebarBtn, sidebar, sidebarOverlay } = elements;
    function openSidebar() { sidebar.classList.add('active'); sidebarOverlay.classList.add('active'); }
    function closeSidebar() { sidebar.classList.remove('active'); sidebarOverlay.classList.remove('active'); }
    openSidebarBtn.addEventListener('click', openSidebar);
    sidebarOverlay.addEventListener('click', closeSidebar);
    elements.navLinks.forEach(link => link.addEventListener('click', closeSidebar));
}

function initInfoToSettings(elements) {
     if(elements.infoToSettingsBtn) {
         elements.infoToSettingsBtn.addEventListener('click', () => {
             const navEvent = { currentTarget: document.querySelector('a[href="#pengaturan"]'), preventDefault: () => {} };
             handleNavigation(navEvent);
             elements.navLinks.forEach(l => l.classList.remove('current-page'));
             document.querySelector('a[href="#pengaturan"]').classList.add('current-page');
         });
     }
}

function initNavigation(elements) {
    const { navLinks, shortcutLinks, sections } = elements;

    window.handleNavigation = (e) => {
        e.preventDefault();
        const targetHref = e.currentTarget.getAttribute('href');
        const targetId = targetHref.substring(1) + '-section';
        
        // Update Sidebar Active State
        const correspondingSidebarLink = document.querySelector(`.sidebar-nav-list a[href="${targetHref}"]`);
        navLinks.forEach(l => l.classList.remove('current-page'));
        if (correspondingSidebarLink) correspondingSidebarLink.classList.add('current-page');

        // Update Section
        sections.forEach(section => section.classList.remove('active'));
        const targetSection = document.getElementById(targetId);
        if (targetSection) targetSection.classList.add('active');

        // Matikan fitur spesifik jika pindah halaman
        if(window.isQiblaActive && targetId !== 'kiblat-section') {
            if(typeof window.stopQiblaCompass === 'function') window.stopQiblaCompass();
        }
        
        if(targetId !== 'quran-section') {
            if(window.Android && window.Android.stopDzikir) window.Android.stopDzikir();
            if(globalAudioPlayer && !globalAudioPlayer.paused) {
                globalAudioPlayer.pause();
                if(window.currentPlayingButton) {
                    window.currentPlayingButton.classList.remove('playing');
                    window.currentPlayingButton.classList.remove('loading');
                }
            }
        }
        window.scrollTo(0, 0);
    };

    navLinks.forEach(link => { link.addEventListener('click', handleNavigation); });
    shortcutLinks.forEach(link => { link.addEventListener('click', handleNavigation); });
    
    // Default Dashboard
    document.querySelector('.sidebar-nav-list a[href="#dashboard"]')?.classList.add('current-page');
    document.getElementById('dashboard-section')?.classList.add('active');
}

function initDarkMode(elements) {
    const { darkModeToggle, autoModeToggle, darkModeIcon } = elements;
    let autoModeInterval; 
    
    function setMode(isDark){
        if(isDark){
            document.body.classList.add('dark-mode');
            if(darkModeIcon) darkModeIcon.classList.add('dark-mode-active');
        } else {
            document.body.classList.remove('dark-mode');
            if(darkModeIcon) darkModeIcon.classList.remove('dark-mode-active');
        }
    }
    
    function checkAutoMode(){
        const isNight = new Date().getHours() >= 18 || new Date().getHours() < 6;
        setMode(isNight);
    }
    
    function applySavedMode(){
        const savedMode = localStorage.getItem('themeMode') || 'auto';
        if(savedMode === 'dark'){
            setMode(true);
            if(darkModeToggle) darkModeToggle.checked = true;
            if(autoModeToggle) autoModeToggle.checked = false;
        } else if(savedMode === 'light'){
            setMode(false);
            if(darkModeToggle) darkModeToggle.checked = false;
            if(autoModeToggle) autoModeToggle.checked = false;
        } else {
            if(autoModeToggle) autoModeToggle.checked = true;
            if(darkModeToggle) darkModeToggle.disabled = true;
            checkAutoMode();
            autoModeInterval = setInterval(checkAutoMode, 60000);
        }
    }
    
    if(darkModeToggle) darkModeToggle.addEventListener('change', () => {
        localStorage.setItem('themeMode', darkModeToggle.checked ? 'dark' : 'light');
        applySavedMode();
    });
    
    if(autoModeToggle) autoModeToggle.addEventListener('change', () => {
        clearInterval(autoModeInterval);
        if(autoModeToggle.checked){
            localStorage.setItem('themeMode', 'auto');
            if(darkModeToggle) darkModeToggle.checked = false;
            if(darkModeToggle) darkModeToggle.disabled = true;
            checkAutoMode();
            autoModeInterval = setInterval(checkAutoMode, 60000);
        } else {
            if(darkModeToggle) darkModeToggle.disabled = false;
            localStorage.setItem('themeMode', 'light');
        }
        applySavedMode();
    });
    
    if(darkModeIcon) darkModeIcon.addEventListener('click', () => {
        const isCurrentlyDark = document.body.classList.contains('dark-mode');
        if(autoModeToggle) autoModeToggle.checked = false;
        if(darkModeToggle) darkModeToggle.disabled = false;
        if(darkModeToggle) darkModeToggle.checked = !isCurrentlyDark;
        localStorage.setItem('themeMode', !isCurrentlyDark ? 'dark' : 'light');
        applySavedMode();
    });
    
    applySavedMode();
}

// =====================================================================
// 5. POPUP LOGIC
// =====================================================================
function initPopupLogic(elements) {
    const { popup, popupTitle, popupMessage, popupIcon, popupAllowBtn, popupDenyBtn } = elements;

    window.hidePermissionPopup = () => { if(popup) popup.classList.remove('active'); }

    window.showPermissionPopup = ({title, message, iconHtml, onAllow, onDeny}) => {
        if(!popup) return;
        popupTitle.textContent = title;
        popupMessage.textContent = message;
        popupIcon.innerHTML = iconHtml;
        
        popupDenyBtn.style.display = 'block';
        popupAllowBtn.textContent = 'Izinkan';

        const newAllowBtn = popupAllowBtn.cloneNode(true);
        popupAllowBtn.parentNode.replaceChild(newAllowBtn, popupAllowBtn);
        
        const newDenyBtn = popupDenyBtn.cloneNode(true);
        popupDenyBtn.parentNode.replaceChild(newDenyBtn, popupDenyBtn);
        
        newAllowBtn.addEventListener('click', () => { onAllow(); hidePermissionPopup(); });
        newDenyBtn.addEventListener('click', () => { onDeny(); hidePermissionPopup(); });
        
        popup.classList.add('active');
    }
    
    window.showCustomPopup = ({title, message, iconHtml, primaryBtnText, onPrimaryClick}) => {
         if(!popup) return;
        popupTitle.textContent = title;
        popupMessage.textContent = message;
        popupIcon.innerHTML = iconHtml;
        
        const denyBtn = document.getElementById('popup-deny-btn');
        denyBtn.style.display = 'none';
        
        const allowBtn = document.getElementById('popup-allow-btn');
        allowBtn.textContent = primaryBtnText || 'OK';

        const newAllowBtn = allowBtn.cloneNode(true);
        allowBtn.parentNode.replaceChild(newAllowBtn, allowBtn);
        
        newAllowBtn.addEventListener('click', () => {
            if(onPrimaryClick) onPrimaryClick();
            hidePermissionPopup();
            setTimeout(() => {
                denyBtn.style.display = 'block';
                newAllowBtn.textContent = 'Izinkan'; 
            }, 300);
        });

        popup.classList.add('active');
    }
}


// =====================================================================
// 6. WAKTU SHOLAT & LOKASI
// =====================================================================

function initAppSettingsAndData(elements) {
    const { locationToggle, notificationToggle, refreshLocationBtn, locationDisplay } = elements;
    
    // Motivasi Toggle
    const motivationToggle = document.getElementById('motivation-toggle');
    const savedMotivPref = localStorage.getItem('motivationEnabled');
    if (motivationToggle) {
        motivationToggle.checked = savedMotivPref === null ? true : (savedMotivPref === 'true');
        motivationToggle.addEventListener('change', (e) => {
            localStorage.setItem('motivationEnabled', e.target.checked);
            if (window.Android && typeof window.Android.setMotivationEnabled === 'function') {
                window.Android.setMotivationEnabled(e.target.checked);
            }
        });
    }

    // Notifikasi Toggle
    if(notificationToggle) {
        const notifPerm = localStorage.getItem('notificationPermission');
        notificationToggle.checked = (notifPerm === 'granted');

        notificationToggle.addEventListener('change', (e) => {
            if (e.target.checked) {
                e.target.checked = false; 
                requestNotificationPermission();
            } else {
                localStorage.setItem('notificationPermission', 'denied');
            }
        });
    }

    // Open Settings Button
    const openSettingsBtn = document.getElementById('open-system-settings-btn');
    if (openSettingsBtn) {
        openSettingsBtn.addEventListener('click', () => {
            if (window.Android && typeof window.Android.openAppSettings === 'function') {
                window.Android.openAppSettings();
            } else {
                alert("Fitur Android Only.");
            }
        });
    }

    // Location Toggle
    if(locationToggle) {
         const locPerm = localStorage.getItem('locationAccess');
         locationToggle.checked = (locPerm === 'granted');
         locationToggle.addEventListener('change', (e) => {
            if(e.target.checked) { e.target.checked = false; requestLocationAccess(); }
            else { localStorage.setItem('locationAccess', 'denied'); fetchPrayerTimes(); }
         });
    }
    
    // Manual Refresh Location Button Logic
    const manualRefreshBtn = document.getElementById('manual-refresh-loc-btn');
    const refreshStatusText = document.getElementById('refresh-status-text');
    if (manualRefreshBtn) {
        manualRefreshBtn.addEventListener('click', () => {
            const icon = manualRefreshBtn.querySelector('i');
            const label = manualRefreshBtn.querySelector('span');
            
            const permissionState = localStorage.getItem('locationAccess');
            if (permissionState !== 'granted') {
                refreshStatusText.textContent = "Aktifkan tombol Akses Lokasi terlebih dahulu.";
                refreshStatusText.style.color = "red";
                setTimeout(() => refreshStatusText.textContent = "", 3000);
                return;
            }

            icon.classList.add('fa-spin');
            label.textContent = "Mencari koordinat...";
            manualRefreshBtn.disabled = true;
            refreshStatusText.textContent = "";

            navigator.geolocation.getCurrentPosition(
                (position) => {
                    const { latitude, longitude } = position.coords;
                    localStorage.setItem('userLocation', JSON.stringify({ latitude, longitude }));
                    localStorage.removeItem('prayerTimesCache'); 
                    fetchPrayerTimes(latitude, longitude);

                    icon.classList.remove('fa-spin');
                    label.textContent = "Perbarui Titik Lokasi";
                    manualRefreshBtn.disabled = false;
                    refreshStatusText.textContent = "Lokasi diperbarui!";
                    refreshStatusText.style.color = "var(--primary-color)";
                    setTimeout(() => refreshStatusText.textContent = "", 3000);
                },
                (error) => {
                    icon.classList.remove('fa-spin');
                    label.textContent = "Perbarui Titik Lokasi";
                    manualRefreshBtn.disabled = false;
                    refreshStatusText.textContent = "Gagal mencari lokasi.";
                    refreshStatusText.style.color = "red";
                },
                { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 }
            );
        });
    }

    // Init Load Prayer Data
    const locationPermission = localStorage.getItem('locationAccess');
    if (locationPermission === 'granted') {
        const userLoc = JSON.parse(localStorage.getItem('userLocation'));
        if (userLoc) fetchPrayerTimes(userLoc.latitude, userLoc.longitude);
        else requestLocationAccess();
    } else {
        fetchPrayerTimes();
    }
}

// --- Permission Handlers ---
window.handleLocationPermissionResult = function(isGranted) {
    const locationToggle = document.getElementById('location-access-toggle');
    if (isGranted) {
        localStorage.setItem('locationAccess', 'granted');
        if(locationToggle) locationToggle.checked = true;
        showPrayerCardLoading(true);
        navigator.geolocation.getCurrentPosition(
            position => {
                const { latitude, longitude } = position.coords;
                localStorage.setItem('userLocation', JSON.stringify({ latitude, longitude }));
                localStorage.removeItem('prayerTimesCache');
                fetchPrayerTimes(latitude, longitude);
                checkAndRequestNotificationPermission();
            },
            error => {
                showPrayerCardLoading(false);
                alert('Gagal mendapatkan koordinat GPS.');
                checkAndRequestNotificationPermission();
            }
        );
    } else {
        localStorage.setItem('locationAccess', 'denied');
        if(locationToggle) locationToggle.checked = false;
        fetchPrayerTimes();
    }
}

window.handleNotificationPermissionResult = function(isGranted) {
    const notificationToggle = document.getElementById('notification-toggle');
    const soundToggle = document.getElementById('sound-toggle');
    if (isGranted) {
        localStorage.setItem('notificationPermission', 'granted');
        if(notificationToggle) notificationToggle.checked = true;
        if(soundToggle) soundToggle.disabled = false;
    } else {
        localStorage.setItem('notificationPermission', 'denied');
        if(notificationToggle) notificationToggle.checked = false;
        if(soundToggle) { soundToggle.checked = false; soundToggle.disabled = true; }
    }
}

function requestLocationAccess() {
    if (window.Android && typeof window.Android.requestNativeLocationPermission === 'function') {
        window.Android.requestNativeLocationPermission();
    } else {
        handleLocationPermissionResult(confirm("Simulasi: Izinkan akses lokasi?"));
    }
}

function requestNotificationPermission() {
    if (window.Android && typeof window.Android.requestNativeNotificationPermission === 'function') {
        window.Android.requestNativeNotificationPermission();
    } else {
        handleNotificationPermissionResult(confirm("Simulasi: Izinkan notifikasi?"));
    }
}

// --- Prayer Times Logic ---
function showPrayerCardLoading(isLoading) {
    const prayerTimeCard = document.querySelector('.prayer-time-card');
    const locationDisplay = document.querySelector('.card-location');
    if (isLoading) {
        if(prayerTimeCard) prayerTimeCard.classList.add('loading');
        if(locationDisplay) locationDisplay.textContent = 'Memperbarui lokasi...';
    } else {
        if(prayerTimeCard) prayerTimeCard.classList.remove('loading');
    }
}

async function fetchCityName(lat, lon) {
    const locationDisplay = document.querySelector('.card-location');
    try {
        const response = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`);
        if (!response.ok) throw new Error('Fail');
        const data = await response.json();
        const city = data.address.city || data.address.state || 'Lokasi Terdeteksi';
        if(locationDisplay) locationDisplay.textContent = city;
    } catch(error) {
        if(locationDisplay) locationDisplay.textContent = "Lokasi Terdeteksi";
    }
}

async function fetchPrayerTimes(lat = null, lon = null) {
    // 1. Cek Data Offline dari Android (Satpam)
    if (window.Android && typeof window.Android.getOfflineJadwal === 'function') {
        const androidData = window.Android.getOfflineJadwal();
        if (androidData) {
            try {
                const parsed = JSON.parse(androidData);
                console.log(" Data Satpam (Offline) digunakan.");
                if (lat && lon) fetchCityName(lat, lon);
                updatePrayerUI(parsed.data);
                return; 
            } catch (e) {}
        }
    }

    // 2. Fallback Fetch API
    showPrayerCardLoading(true);
    if (lat && lon && window.Android && typeof window.Android.saveUserLocation === 'function') {
        window.Android.saveUserLocation(lat.toString(), lon.toString());
    }

    const adhanApiBase = 'https://api.aladhan.com/v1';
    let apiUrl;
    const locationDisplay = document.querySelector('.card-location');
    
    if (lat && lon) {
        apiUrl = `${adhanApiBase}/timings?latitude=${lat}&longitude=${lon}&method=11`;
        fetchCityName(lat, lon);
    } else {
        apiUrl = `${adhanApiBase}/timingsByCity?city=Medan&country=Indonesia&method=11`;
        if(locationDisplay) locationDisplay.textContent = "Medan, Sumatera Utara";
    }

    try {
        const response = await fetch(apiUrl);
        const data = await response.json();
        if (data.code === 200) updatePrayerUI(data.data);
    } catch (error) {
        console.error("Gagal fetch manual:", error);
        showPrayerCardLoading(false);
    }
}

function updatePrayerUI(data) {
    const ADJUSTMENT = 2;
    const times = data.timings;
    
    function adjustTime(timeStr, minutes) {
        let [h, m] = timeStr.split(':').map(Number);
        let date = new Date();
        date.setHours(h, m + minutes, 0);
        return `${String(date.getHours()).padStart(2, '0')}:${String(date.getMinutes()).padStart(2, '0')}`;
    }

    const prayerData = {
        Imsak: adjustTime(times.Imsak, ADJUSTMENT),
        Fajr: adjustTime(times.Fajr, ADJUSTMENT),
        Dhuhr: times.Dhuhr,
        Asr: times.Asr,
        Maghrib: times.Maghrib,
        Isha: adjustTime(times.Isha, ADJUSTMENT)
    };
    
    Object.keys(prayerData).forEach(key => {
        const el = document.getElementById(`time-${key}`);
        if(el) el.textContent = prayerData[key];
    });
    
    todayPrayerTimes = prayerData;
    const hijri = data.date.hijri;
    const dateEl = document.getElementById('currentDateHijri');
    if(dateEl) dateEl.textContent = `${hijri.weekday.ar}, ${hijri.day} ${hijri.month.ar} ${hijri.year} H`;
    
    highlightNextPrayer();
    showPrayerCardLoading(false);

    // Set Alarm jika diizinkan
    const isAdzanEnabled = localStorage.getItem('notificationPermission') === 'granted';
    if (isAdzanEnabled && window.Android && typeof window.Android.schedulePrayerAlarm === 'function') {
        window.Android.schedulePrayerAlarm("Imsak", prayerData.Imsak);
        window.Android.schedulePrayerAlarm("Subuh", prayerData.Fajr);
        window.Android.schedulePrayerAlarm("Dzuhur", prayerData.Dhuhr);
        window.Android.schedulePrayerAlarm("Ashar", prayerData.Asr);
        window.Android.schedulePrayerAlarm("Maghrib", prayerData.Maghrib);
        window.Android.schedulePrayerAlarm("Isya", prayerData.Isha);
    }
}
    
function highlightNextPrayer() {
    const now = new Date();
    const currentTime = now.getHours() * 60 + now.getMinutes();
    const prayerOrder = ['Fajr', 'Dhuhr', 'Asr', 'Maghrib', 'Isha'];
    let nextPrayerFound = false;
    
    document.querySelectorAll('.prayer-time-item').forEach(item => item.classList.remove('next-prayer'));
    
    for (const prayer of prayerOrder) {
        const timeEl = document.getElementById(`time-${prayer}`);
        if (!timeEl) continue;
        const timeStr = timeEl.textContent;
        if (timeStr === '--:--' || timeStr === '...') continue;
        
        const [h, m] = timeStr.split(':').map(Number);
        const prayerTime = h * 60 + m;
        
        if (currentTime < prayerTime) {
            timeEl.closest('.prayer-time-item').classList.add('next-prayer');
            nextPrayerFound = true;
            break;
        }
    }
    
    if (!nextPrayerFound) {
        const fajrItem = document.getElementById('time-Fajr');
        if (fajrItem) fajrItem.closest('.prayer-time-item').classList.add('next-prayer');
    }
}

// =====================================================================
// 7. AUDIO DASHBOARD (Dzikir Pagi/Petang)
// =====================================================================
function initDashboardAudio(elements) {
    const audioContainer = document.querySelector('.featured-zikir-container');
    
    window.resetDzikirButtons = function() {
        document.querySelectorAll('.audio-controls-container').forEach(container => {
            container.querySelector('.play-btn').classList.remove('hidden');
            container.querySelector('.pause-btn').classList.add('hidden');
            container.querySelector('.stop-btn').classList.add('hidden');
        });
    };

    if (audioContainer) {
        audioContainer.addEventListener('click', (e) => {
            const playBtn = e.target.closest('.play-btn');
            const stopBtn = e.target.closest('.stop-btn');
            
            if (playBtn) {
                const targetType = playBtn.dataset.target.replace('audio-', ''); 
                const container = playBtn.parentElement;
                window.resetDzikirButtons();

                if (window.Android && typeof window.Android.playDzikir === 'function') {
                    window.Android.playDzikir(targetType);
                } else {
                    alert("Fitur Audio ini butuh aplikasi Android.");
                }
                playBtn.classList.add('hidden');
                container.querySelector('.stop-btn').classList.remove('hidden'); 
            }

            if (stopBtn) {
                const container = stopBtn.parentElement;
                if (window.Android && typeof window.Android.stopDzikir === 'function') {
                    window.Android.stopDzikir();
                }
                stopBtn.classList.add('hidden');
                container.querySelector('.play-btn').classList.remove('hidden');
            }
        });
    }
}

// =====================================================================
// 8. QURAN FEATURE (UPDATED LOGIC)
// =====================================================================

function stopQuranAutoplay() {
    isQuranAutoplayActive = false;
    const btn = document.getElementById('quran-autoplay-toggle');
    if(btn) {
        btn.classList.remove('active');
        btn.querySelector('span').textContent = 'Autoplay: Mati';
    }
    if(window.Android && window.Android.stopDzikir) window.Android.stopDzikir();
}

// Fungsi Utama Play Audio Ayat (Diperbarui)
window.playVerseAudio = function(button, audioUrl, verseNumber, verseId) {
    // Matikan Dzikir Dashboard
    if(typeof window.resetDzikirButtons === 'function') window.resetDzikirButtons();
    
    // Reset tombol ayat lain
    if (window.currentPlayingButton && window.currentPlayingButton !== button) {
        window.currentPlayingButton.classList.remove('playing');
        window.currentPlayingButton.classList.remove('loading');
    }
    
    window.currentPlayingButton = button;
    
    // SCROLL OTOMATIS
    scrollToActiveVerse(verseId);

    // Play via Android (Priority)
    if (window.Android && typeof window.Android.playAudio === 'function') {
        const surahTitle = document.getElementById('surah-detail-title').textContent;
        button.classList.add('loading');
        window.Android.playAudio(audioUrl, surahTitle, "Ayat " + verseNumber);
    } else {
        // Fallback Web Player
        if(globalAudioPlayer) {
            globalAudioPlayer.src = audioUrl;
            globalAudioPlayer.play();
            button.classList.add('playing');
        }
    }
};

function initQuranFeature() {
    const surahListContainer = document.getElementById('surah-list-content');
    const surahDetailContainer = document.getElementById('surah-detail-container');
    const surahListWrapper = document.getElementById('surah-list-container');
    const backToSurahListBtn = document.getElementById('back-to-surah-list-btn');
    
    const autoplayToggleBtn = document.getElementById('quran-autoplay-toggle');
    if (autoplayToggleBtn) {
        autoplayToggleBtn.addEventListener('click', () => {
            isQuranAutoplayActive = !isQuranAutoplayActive;
            autoplayToggleBtn.classList.toggle('active', isQuranAutoplayActive);
            autoplayToggleBtn.querySelector('span').textContent = isQuranAutoplayActive ? 'Autoplay: Aktif' : 'Autoplay: Mati';
        });
    }
    
    if(backToSurahListBtn) {
        backToSurahListBtn.addEventListener('click', () => {
            stopQuranAutoplay();
            surahDetailContainer.style.display = 'none';
            surahListWrapper.style.display = 'block';
        });
    }
}

// Load Detail Surah (Diperbarui untuk Autoplay Next Surah)
window.loadSurahDetail = async function(surahNumber, playOnLoad = false) {
    // Stop audio lama
    if (window.Android && typeof window.Android.stopDzikir === 'function') window.Android.stopDzikir();
    
    currentSurahNumber = surahNumber;
    
    document.getElementById('surah-list-container').style.display = 'none';
    document.getElementById('surah-detail-container').style.display = 'block';
    
    const contentEl = document.getElementById('surah-detail-content');
    const loadingEl = document.getElementById('surah-detail-loading');
    
    contentEl.innerHTML = '';
    loadingEl.style.display = 'block';
    window.scrollTo(0, 0);

    // Handle Toggle UI State
    const autoBtn = document.getElementById('quran-autoplay-toggle');
    if (playOnLoad) {
        isQuranAutoplayActive = true;
        if(autoBtn) {
            autoBtn.classList.add('active');
            autoBtn.querySelector('span').textContent = 'Autoplay: Aktif';
        }
    } else if (autoBtn) {
        // Jika user klik manual dari list, jangan nyalakan autoplay dulu (opsional)
        // isQuranAutoplayActive = false; 
        // autoBtn.classList.remove('active');
    }

    try {
        const response = await fetch(`https://api.alquran.cloud/v1/surah/${surahNumber}/editions/quran-uthmani,id.indonesian,en.transliteration,ar.alafasy`);
        const data = await response.json();
        const editions = data.data; 

        document.getElementById('surah-detail-title').textContent = editions[0].englishName;
        document.getElementById('surah-detail-info').textContent = `${editions[0].englishNameTranslation}  ${editions[0].numberOfAyahs} Ayat`;

        contentEl.innerHTML = ''; 

        const totalAyat = editions[0].numberOfAyahs;
        let firstVerseToPlay = null;

        for (let i = 0; i < totalAyat; i++) {
            const uniqueId = `verse-${surahNumber}-${i+1}`;
            const verseNum = editions[0].ayahs[i].numberInSurah;
            const audioUrl = editions[3].ayahs[i].audio;

            const div = document.createElement('div');
            div.className = 'verse-item';
            div.id = uniqueId;

            div.innerHTML = `
                <div class="verse-number">${verseNum}</div>
                <p class="verse-arabic">${editions[0].ayahs[i].text}</p>
                <p class="verse-translation">${editions[1].ayahs[i].text}</p>
                <div class="verse-controls">
                    <button class="audio-control-btn">
                        <i class="fas fa-play icon-play"></i>
                        <i class="fas fa-pause icon-pause"></i>
                        <i class="fas fa-spinner fa-spin icon-loading"></i>
                    </button>
                    <span>Mishary Rashid</span>
                </div>
            `;

            const btn = div.querySelector('.audio-control-btn');
            btn.addEventListener('click', () => {
                playVerseAudio(btn, audioUrl, verseNum, uniqueId);
            });
            
            // Simpan data ayat pertama untuk autoplay
            if (i === 0) {
                firstVerseToPlay = { btn, url: audioUrl, num: verseNum, id: uniqueId };
            }

            contentEl.appendChild(div);
        }

        // EKSEKUSI AUTOPLAY NEXT SURAH
        if (playOnLoad && firstVerseToPlay) {
            console.log("JS: Menjalankan Autoplay Surat Baru...");
            setTimeout(() => {
                playVerseAudio(firstVerseToPlay.btn, firstVerseToPlay.url, firstVerseToPlay.num, firstVerseToPlay.id);
            }, 1500);
        }

    } catch (error) {
        console.error(error);
        contentEl.innerHTML = '<p style="color:red; text-align:center;">Gagal memuat data.</p>';
    } finally {
        loadingEl.style.display = 'none';
    }
};

// Load Daftar Surat (API Gading / Santrikoding)
async function loadSurahList() {
    const container = document.getElementById('surah-list-content');
    if(!container) return;
    
    const cached = localStorage.getItem('surahListCache');
    if(cached) { renderSurahList(JSON.parse(cached)); return; }

    try {
        const res = await fetch('https://quran-api.santrikoding.com/api/surah');
        const data = await res.json();
        localStorage.setItem('surahListCache', JSON.stringify(data));
        renderSurahList(data);
    } catch(e) {
        container.innerHTML = "Gagal memuat daftar surat.";
    }
}

function renderSurahList(data) {
    const container = document.getElementById('surah-list-content');
    if(!container) return;
    container.innerHTML = '';
    data.forEach(s => {
        const el = document.createElement('div');
        el.className = 'surah-item';
        el.innerHTML = `
            <div class="surah-item-info">
                <div class="surah-number">${s.nomor}</div>
                <div class="surah-name"><h4>${s.nama_latin}</h4><p>${s.arti}</p></div>
            </div>
            <div class="surah-arabic-name">${s.nama}</div>
        `;
        el.onclick = () => loadSurahDetail(s.nomor, false);
        container.appendChild(el);
    });
    document.getElementById('surah-list-loading').style.display = 'none';
}


// =====================================================================
// 9. FITUR LAIN (Tasbih, Kiblat, Slider)
// =====================================================================

function initDhikrSlider() {
    const dhikrContainer = document.querySelector('.dhikr-container-new');
    if(!dhikrContainer) return;

    const slider = dhikrContainer.querySelector('.dhikr-slider-new');
    const slides = dhikrContainer.querySelectorAll('.dhikr-slide-new');
    const nextBtn = dhikrContainer.querySelector('.slider-nav-new.next');
    const prevBtn = dhikrContainer.querySelector('.slider-nav-new.prev');
    const totalSlides = slides.length;
    let currentIndex = 0;
    dhikrCounts = new Array(totalSlides).fill(0);

    const goToSlide = (index) => {
        if(index < 0) index = 0;
        if(index >= totalSlides) index = totalSlides - 1;
        slider.style.transform = `translateX(-${index * 100}%)`;
        currentIndex = index;
        updateSlideState(currentIndex);
    };
    
    const updateSlideState = (index) => {
        slides.forEach((slide, i) => {
            if(i === index) initializeCounter(slide, index);
        });
    };
    
    const initializeCounter = (slide, index) => {
        const counterBtn = slide.querySelector('.progress-counter');
        const countDisplay = slide.querySelector('.count-display-new');
        const ring = slide.querySelector('.progress-ring__circle');
        const progressBarFill = slide.querySelector('.progress-bar-fill');
        const resetBtn = slide.querySelector('.reset-btn-new');
        const maxCount = parseInt(counterBtn.dataset.max);
        let count = dhikrCounts[index]; 
        
        const radius = ring.r.baseVal.value;
        const circumference = 2 * Math.PI * radius;
        ring.style.strokeDasharray = `${circumference} ${circumference}`;
        
        const setProgress = (percent) => {
            const offset = circumference - (percent / 100) * circumference;
            ring.style.strokeDashoffset = offset;
            const overallProgress = (((index + (count / maxCount)) / totalSlides)) * 100;
            progressBarFill.style.width = `${overallProgress}%`;
        };
        
        const updateCounterUI = () => {
            countDisplay.textContent = count;
            const progressPercent = (count / maxCount) * 100;
            setProgress(progressPercent);
        };

        const resetCounter = () => { count = 0; dhikrCounts[index] = 0; updateCounterUI(); };
        updateCounterUI();
        
        const newCounterBtn = counterBtn.cloneNode(true);
        counterBtn.parentNode.replaceChild(newCounterBtn, counterBtn);
        const newResetBtn = resetBtn.cloneNode(true);
        resetBtn.parentNode.replaceChild(newResetBtn, resetBtn);
        
        newCounterBtn.addEventListener('click', () => {
            if (count >= maxCount) return; 
            count++; dhikrCounts[index] = count; updateCounterUI();
            if(navigator.vibrate) navigator.vibrate(50);
            if(count === maxCount){
                if(navigator.vibrate) navigator.vibrate(80);
                if(currentIndex < totalSlides - 1){
                    setTimeout(() => goToSlide(currentIndex + 1), 500);
                } else {
                    showCustomPopup({
                        title: 'MasyaAllah!',
                        message: 'Anda telah menyelesaikan Dzikir Ba\'da Sholat.',
                        iconHtml: '<i class="fas fa-check-circle" style="color: var(--secondary-color);"></i>',
                        primaryBtnText: 'Alhamdulillah'
                    });
                }
            }
        });
        newResetBtn.addEventListener('click', resetCounter);
    };
    
    nextBtn.addEventListener('click', () => goToSlide(currentIndex + 1));
    prevBtn.addEventListener('click', () => goToSlide(currentIndex - 1));
    goToSlide(0);
}

function initAccordions() {
    const headers = document.querySelectorAll('.step-header');
    headers.forEach(header => {
        header.addEventListener('click', () => {
            const content = header.nextElementSibling;
            const isActive = header.classList.contains('active');
            headers.forEach(h => {
                if (h !== header && h.classList.contains('active')) {
                    h.classList.remove('active');
                    h.nextElementSibling.style.maxHeight = null;
                }
            });
            if(isActive) {
                header.classList.remove('active');
                content.style.maxHeight = null;
            } else {
                header.classList.add('active');
                content.style.maxHeight = content.scrollHeight + "px";
            }
        });
    });
}

function setupQiblaFeature() {
    window.isQiblaActive = false;
    const permissionPromptEl = document.getElementById('kiblat-permission-prompt');
    const permissionBtn = document.getElementById('kiblat-permission-btn');
    const compassUiContainer = document.querySelector('.compass-ui-container');
    const compassCircleEl = document.getElementById('qibla-compass-circle');
    const roseEl = document.getElementById('compass-rose');
    const pointerEl = document.getElementById('qibla-pointer');
    const degreeDisplayEl = document.querySelector('.direction-degree');
    let orientationSensor = null;

    if (!permissionPromptEl) return; 

    function calculateQiblaBearing(lat, lon) {
        const toRad = (deg) => deg * Math.PI / 180;
        const kaabaLat = toRad(21.4225);
        const userLat = toRad(lat);
        const dLon = toRad(39.8262 - lon);
        const y = Math.sin(dLon) * Math.cos(kaabaLat);
        const x = Math.cos(userLat) * Math.sin(kaabaLat) - Math.sin(userLat) * Math.cos(kaabaLat) * Math.cos(dLon);
        return (Math.atan2(y, x) * (180 / Math.PI) + 360) % 360;
    }

    async function startCompass() {
        window.isQiblaActive = true;
        compassUiContainer.style.display = 'flex';
        permissionPromptEl.style.display = 'none';
        degreeDisplayEl.innerHTML = 'Kalibrasi...';

        try {
            const position = await new Promise((resolve, reject) => {
                navigator.geolocation.getCurrentPosition(resolve, reject, { enableHighAccuracy: true });
            });
            const qiblaBearing = calculateQiblaBearing(position.coords.latitude, position.coords.longitude);
            degreeDisplayEl.textContent = `Arah Kiblat: ${qiblaBearing.toFixed(1)}`;

            if ('AbsoluteOrientationSensor' in window) {
                orientationSensor = new AbsoluteOrientationSensor({ frequency: 60 });
                orientationSensor.onreading = () => {
                    if (!orientationSensor.quaternion) return;
                    const q = orientationSensor.quaternion;
                    // Convert quaternion to Euler angles (yaw)
                    let yaw = Math.atan2(2 * (q[3] * q[2] + q[0] * q[1]), 1 - 2 * (q[1] * q[1] + q[2] * q[2]));
                    const trueHeading = (360 - (yaw * (180 / Math.PI))) % 360;
                    
                    roseEl.style.transform = `rotate(${-trueHeading}deg)`;
                    pointerEl.style.transform = `rotate(${qiblaBearing - trueHeading}deg)`;
                    
                    const alignmentCheck = Math.abs((qiblaBearing - trueHeading) % 360);
                    if (alignmentCheck < 3 || alignmentCheck > 357) {
                         compassCircleEl.classList.add('aligned');
                    } else {
                         compassCircleEl.classList.remove('aligned');
                    }
                };
                orientationSensor.start();
            } else {
               degreeDisplayEl.textContent = 'Sensor Kompas tidak didukung browser ini.';
            }
        } catch (error) {
            degreeDisplayEl.textContent = 'Gagal GPS.';
        }
    }
    
    window.stopQiblaCompass = function() {
        if (orientationSensor) { orientationSensor.stop(); orientationSensor = null; }
        window.isQiblaActive = false;
    }

    permissionBtn.addEventListener('click', async () => {
        if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
             await DeviceOrientationEvent.requestPermission();
        }
        startCompass();
    });
}

function setupTasbihDigital() {
    const tasbihSetupEl = document.getElementById('tasbih-setup');
    const tasbihCounterEl = document.getElementById('tasbih-counter');
    if(!tasbihSetupEl) return;
    
    const dzikirSelect = document.getElementById('dzikir-select');
    const customDzikirInput = document.getElementById('custom-dzikir-input');
    const dzikirTargetInput = document.getElementById('dzikir-target');
    const startBtn = document.getElementById('start-tasbih-btn');
    const countDisplay = document.getElementById('tasbih-count-display');
    const incrementBtn = document.getElementById('increment-tasbih-btn');
    const resetCountBtn = document.getElementById('reset-count-btn');
    const resetSetupLink = document.getElementById('reset-setup-link');

    let currentCount = 0; let targetCount = 0;

    dzikirSelect.addEventListener('change', () => {
        customDzikirInput.style.display = (dzikirSelect.value === 'custom') ? 'block' : 'none';
    });

    startBtn.addEventListener('click', () => {
        const val = dzikirSelect.value;
        let text = (val === 'custom') ? customDzikirInput.value.trim() : val;
        targetCount = parseInt(dzikirTargetInput.value, 10);
        if (!text || !targetCount) return alert("Isi data tasbih.");
        
        document.getElementById('display-dzikir-text').textContent = text;
        document.getElementById('display-dzikir-target').textContent = `${targetCount}x`;
        currentCount = 0;
        countDisplay.textContent = currentCount;
        tasbihSetupEl.style.display = 'none';
        tasbihCounterEl.style.display = 'flex';
    });

    incrementBtn.addEventListener('click', () => {
        if (currentCount < targetCount) {
            currentCount++;
            countDisplay.textContent = currentCount;
            if (navigator.vibrate) navigator.vibrate(50);
            if (currentCount === targetCount) {
                 if (navigator.vibrate) navigator.vibrate(100);
                 showCustomPopup({ title: 'Selesai!', message: 'Target dzikir tercapai.', iconHtml: '<i class="fas fa-check"></i>' });
            }
        }
    });

    resetCountBtn.addEventListener('click', () => { currentCount = 0; countDisplay.textContent = 0; });
    resetSetupLink.addEventListener('click', (e) => {
        e.preventDefault();
        tasbihCounterEl.style.display = 'none';
        tasbihSetupEl.style.display = 'flex';
    });
}

function setupButtonSlider() {
    const slider = document.querySelector('.survey-slider');
    if (!slider) return;
    const slides = slider.querySelectorAll('.survey-button');
    if (slides.length === 0) return;
    let slideHeight = slides[0].offsetHeight;
    
    function startSlider() {
        if (slideHeight === 0) { setTimeout(() => { slideHeight = slides[0].offsetHeight; if(slideHeight > 0) startSlider(); }, 500); return; }
        let currentSlide = 0;
        setInterval(() => {
            currentSlide = (currentSlide + 1) % slides.length;
            slider.style.transform = `translateY(-${currentSlide * slideHeight}px)`;
        }, 5000);
    }
    startSlider();
}

if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
        navigator.serviceWorker.register('sw.js').catch(err => console.log('SW Fail:', err));
    });
}
</script>
</body>
</html> 
